import{_ as f,G as d,o as l,a as m,b as t,t as i,f as u,j as a,K as g,F as v,m as h,k,v as p,h as x,i as w}from"./app-DSMprFLy.js";const I={name:"PaymentForm",data(){return{loading:!1,isEdit:!1,paymentId:null,unpaidInvoices:[],selectedInvoice:null,form:{invoice_id:"",payment_date:new Date().toISOString().split("T")[0],amount:0,payment_method:"bank_transfer",reference_number:"",notes:""}}},mounted(){this.paymentId=this.$route.params.id,this.isEdit=!!this.paymentId,this.isEdit?this.loadPayment():this.loadUnpaidInvoices()},methods:{async loadUnpaidInvoices(){try{const{data:n}=await d.get("/invoices/unpaid");this.unpaidInvoices=n.data||[],console.log("Loaded unpaid invoices:",this.unpaidInvoices.length)}catch(n){console.error("Failed to load invoices:",n),this.$emit("showToast","Failed to load invoices","error")}},async loadPayment(){this.loading=!0;try{const{data:n}=await d.get(`/payments/${this.paymentId}`);this.form={invoice_id:n.invoice_id,payment_date:n.payment_date,amount:n.amount,payment_method:n.payment_method,reference_number:n.reference_number||"",notes:n.notes||""},this.selectedInvoice=n.invoice}catch(n){console.error("Failed to load payment:",n),this.$emit("showToast","Failed to load payment","error"),this.$router.push({name:"payments-index"})}finally{this.loading=!1}},onInvoiceChange(){this.selectedInvoice=this.unpaidInvoices.find(n=>n.id===parseInt(this.form.invoice_id)),this.selectedInvoice&&(this.form.amount=this.selectedInvoice.remaining_balance)},formatCurrency(n){return"Rp "+Number(n).toLocaleString("id-ID")},async submit(){var n,e;this.loading=!0;try{this.isEdit?(await d.put(`/payments/${this.paymentId}`,this.form),this.$emit("showToast","✅ Payment updated successfully","success")):(await d.post("/payments",this.form),this.$emit("showToast","✅ Payment recorded successfully","success")),this.$router.push({name:"payments-index"})}catch(c){const y=((e=(n=c.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to save payment";this.$emit("showToast",y,"error")}finally{this.loading=!1}}}},_={class:"p-6 max-w-4xl mx-auto"},C={class:"mb-6"},P={class:"text-2xl font-bold dark:text-white"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},V={class:"md:col-span-2"},E=["disabled"],F=["value"],S={key:0,class:"mt-2 p-3 bg-blue-50 dark:bg-blue-900 rounded text-sm dark:text-gray-200"},U={class:"font-bold"},N=["max"],D={class:"md:col-span-2"},R={class:"flex gap-4 mt-6"},B=["disabled"];function q(n,e,c,y,o,s){var b;return l(),m("div",_,[t("div",C,[t("h1",P,i(o.isEdit?"Edit Payment":"Record Payment"),1)]),t("form",{onSubmit:e[8]||(e[8]=w((...r)=>s.submit&&s.submit(...r),["prevent"])),class:"bg-white dark:bg-gray-800 rounded shadow p-6"},[t("div",T,[t("div",V,[e[11]||(e[11]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Invoice "),t("span",{class:"text-red-500"},"*")],-1)),a(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.invoice_id=r),onChange:e[1]||(e[1]=(...r)=>s.onInvoiceChange&&s.onInvoiceChange(...r)),required:"",disabled:o.isEdit,class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},[e[9]||(e[9]=t("option",{value:""},"Select Invoice",-1)),(l(!0),m(v,null,h(o.unpaidInvoices,r=>(l(),m("option",{key:r.id,value:r.id},i(r.invoice_number)+" - "+i(r.customer_name)+" (Remaining: "+i(s.formatCurrency(r.remaining_balance))+") ",9,F))),128))],40,E),[[g,o.form.invoice_id]]),o.selectedInvoice?(l(),m("div",S,[e[10]||(e[10]=t("div",{class:"font-medium"},"Invoice Details:",-1)),t("div",null,"Total: "+i(s.formatCurrency(o.selectedInvoice.total)),1),t("div",null,"Paid: "+i(s.formatCurrency(o.selectedInvoice.paid_amount||0)),1),t("div",U,"Remaining: "+i(s.formatCurrency(o.selectedInvoice.remaining_balance)),1)])):k("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Payment Date "),t("span",{class:"text-red-500"},"*")],-1)),a(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.payment_date=r),type:"date",required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},null,512),[[p,o.form.payment_date]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Amount "),t("span",{class:"text-red-500"},"*")],-1)),a(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.amount=r),type:"number",step:"0.01",min:"0",max:(b=o.selectedInvoice)==null?void 0:b.remaining_balance,required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"0.00"},null,8,N),[[p,o.form.amount]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),a(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.payment_method=r),required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},e[14]||(e[14]=[x('<option value="cash">Cash</option><option value="bank_transfer">Bank Transfer</option><option value="check">Check</option><option value="giro">Giro</option><option value="credit_card">Credit Card</option><option value="other">Other</option>',6)]),512),[[g,o.form.payment_method]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},"Reference Number",-1)),a(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.reference_number=r),type:"text",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"Bank ref, check number, etc"},null,512),[[p,o.form.reference_number]])]),t("div",D,[e[17]||(e[17]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},"Notes",-1)),a(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.notes=r),rows:"3",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"Additional notes..."},null,512),[[p,o.form.notes]])])]),t("div",R,[t("button",{type:"submit",disabled:o.loading,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50"},i(o.loading?"Saving...":o.isEdit?"Update":"Record Payment"),9,B),t("button",{type:"button",onClick:e[7]||(e[7]=r=>n.$router.push({name:"payments-index"})),class:"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 px-6 py-2 rounded dark:text-white"}," Cancel ")])],32)])}const A=f(I,[["render",q]]);export{A as default};
