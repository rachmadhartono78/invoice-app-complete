import{s as _}from"./index-CfpBvlcq.js";import{_ as C,g as v,o as d,a as u,e as k,b as t,t as h,j as f,v as w,F as p,m as b,k as S,i as M,x}from"./app-B6zZeFFz.js";const V={data(){return{loading:!1,form:{application_id:"",name:"",code:"",menus:[]},modalCreate:null,dialogConfirmation:!1,typeSubmit:"",id:"",applications:[],menus:[],actions:[],selectedNewMenu:null}},computed:{availableMenus(){const i=this.form.menus.map(e=>e.id);return this.menus.filter(e=>!i.includes(e.id))}},created(){this.id=this.$route.params.id,this.retrieveApplication(),this.retrieveMenu(),this.retrieveActions().then(()=>{this.id&&this.doGetDataDetail(this.id)})},mounted(){},beforeUnmount(){},watch:{},methods:{retrieveApplication(){this.loading=!0,this.axios.get("v1/settings/applications").then(i=>{this.applications=i.data}).catch(i=>{console.log(i)}).finally(()=>this.loading=!1)},retrieveMenu(){this.loading=!0,this.axios.get("v1/settings/menus").then(i=>{this.menus=i.data.map(e=>(e.name=`${e.name} - ${e.url}`,e))}).catch(i=>{console.log(i)}).finally(()=>this.loading=!1)},retrieveActions(){return console.log("get actions"),this.loading=!0,this.axios.get("v1/settings/actions").then(i=>{this.actions=i.data}).catch(i=>{console.log(i)}).finally(()=>this.loading=!1)},doGetDataDetail(){console.log("get data detail"),this.loading=!0,this.axios.get("v1/settings/authorities/"+this.id).then(i=>{this.form=i.data,this.form.menus.forEach(e=>{!e.actions||!e.actions.length?e.actions=this.createDefaultActions():e.actions=this.normalizeMenuActions(e.actions)})}).catch(i=>{console.log(i)}).finally(()=>this.loading=!1)},createDefaultActions(){return this.actions.map(i=>({action:i,action_id:i.id,value:0}))},normalizeMenuActions(i){const e={};return i.forEach(a=>{var r;const l=((r=a.action)==null?void 0:r.id)||a.action_id;e[l]=a}),this.actions.map(a=>e[a.id]?e[a.id]:{action:a,action_id:a.id,value:0})},getMenuName(i){const e=this.menus.find(a=>a.id===i);return e?e.name.split(" - ")[0]:"Menu tidak ditemukan"},getMenuUrl(i){const e=this.menus.find(a=>a.id===i);return e?e.url:""},isActionChecked(i,e){const a=this.form.menus[i];if(!a||!a.actions)return!1;const l=a.actions.find(r=>{var n;return(((n=r.action)==null?void 0:n.id)||r.action_id)===e});return l?l.value==1:!1},handleActionToggle(i,e,a){const l=this.form.menus[i];if(!l||!l.actions)return;const r=l.actions.findIndex(s=>{var g;return(((g=s.action)==null?void 0:g.id)||s.action_id)===e});r!==-1&&(l.actions[r].value=a.target.checked?1:0)},handleMenuSelect(i){this.selectedNewMenu=i,console.log("Selected menu:",i)},addSelectedMenu(){if(!this.selectedNewMenu)return;const i=typeof this.selectedNewMenu=="object"?this.selectedNewMenu.id:this.selectedNewMenu,e=this.menus.find(l=>l.id===i);if(!e){this.$emit("showToast","Menu tidak ditemukan","error");return}const a={id:e.id,name:e.name,url:e.url,actions:this.createDefaultActions()};this.form.menus.push(a),this.selectedNewMenu=null},confirmSubmit(i){if(!this.form.name||!this.form.code||!this.form.application_id){this.$emit("showToast","Harap lengkapi semua field yang wajib diisi","error");return}if(this.form.menus.filter(a=>a.id&&a.id!=="").length===0){this.$emit("showToast","Harap tambahkan minimal satu menu","error");return}this.dialogConfirmation=!0},removeMenus(i){this.form.menus.splice(i,1)},handleTypeSubmit(i){this.typeSubmit=i},resetForm(){this.form={application_id:"",name:"",code:"",menus:[]},this.selectedNewMenu=null},handleOnClose(i){i===!0?this.submit():this.dialogConfirmation=!1},handleDepartmentSelect(i){},submit(){let i="v1/settings/authorities";this.loading=!0;const e=this.form.menus.filter(s=>s.id&&s.id!==""),a={...this.form,menus:e.map(s=>({id:s.id,actions:s.actions.map(n=>{var g;return{action_id:((g=n.action)==null?void 0:g.id)||n.action_id,value:n.value||0}}).filter(n=>n.action_id)}))};console.log("Submit data:",a),console.log("Valid menus count:",e.length);const l={indices:!0,nullsAsUndefineds:!1,booleansAsIntegers:!1,allowEmptyArrays:!1,noFilesWithArrayNotation:!1,dotsForObjectNotation:!1};let r=new FormData;r=_.serialize(a,l),this.id&&(i+="/"+this.id,r.append("_method","PUT")),this.axios.post(i,r).then(s=>{var n;this.$emit("showToast",((n=s.data)==null?void 0:n.message)||"Berhasil!","success"),this.dialogConfirmation=!1,this.typeSubmit==="createNew"?this.resetForm():this.$router.push({name:"index-authorities"})}).catch(s=>{var n,g,o;this.loading=!1,console.error("Error submitting authority:",s),console.error("Error response:",(n=s.response)==null?void 0:n.data),this.$emit("showToast",((o=(g=s.response)==null?void 0:g.data)==null?void 0:o.message)||s.message,"error")}).finally(()=>{this.loading=!1})}}},A={class:"relative sm:p-4 xs:p-0 w-full h-full md:h-auto"},N={class:"relative p-4 bg-white rounded-lg shadow dark:bg-gray-800 sm:p-5"},T={class:"flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-600"},D={class:"text-lg font-semibold text-gray-900 dark:text-white"},j={class:"grid gap-4 mb-4 sm:grid-cols-2"},B=["disabled"],H={key:0,class:"relative overflow-x-auto shadow-md sm:rounded-lg mb-6"},U={class:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"},z={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},E={class:"px-6 py-4 font-medium text-gray-900 dark:text-white"},F={class:"flex flex-col"},O={class:"font-semibold"},I={class:"text-xs text-gray-500"},Z=["id","checked","onChange"],q={class:"px-6 py-4 text-center"},K=["onClick"],L={class:"block md:hidden"},G={class:"absolute right-0 top-2"},P=["onClick"],W={class:"mb-4"},J={class:"font-semibold text-gray-900 dark:text-white"},Q={class:"text-sm text-gray-500"},R={class:"grid grid-cols-2 gap-2"},X=["id","checked","onChange"],Y=["for"],$={class:"relative p-4 bg-white my-4 rounded-lg shadow dark:bg-gray-800 sm:p-5"},ee={class:"flex gap-4 items-end"},te={class:"flex-1"},ie=["disabled"],re={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-5"},se={class:"mr-1 -ml-1 w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},oe={class:"mr-1 -ml-1 w-6 h-6","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"};function ae(i,e,a,l,r,s){const n=v("confirmation-dialog"),g=v("autocomplete");return d(),u("div",null,[k(n,{isVisible:r.dialogConfirmation,title:"Simpan data",loading:r.loading,message:"Apakah kamu yakin ingin menyimpan data ini?",onOnClose:e[0]||(e[0]=o=>s.handleOnClose(o))},null,8,["isVisible","loading"]),t("form",{onSubmit:e[9]||(e[9]=M((...o)=>s.confirmSubmit&&s.confirmSubmit(...o),["prevent"]))},[t("div",A,[t("div",N,[t("div",T,[t("h3",D,h(r.id?"Ubah":"Tambah")+" Otoritas ",1)]),t("div",j,[t("div",null,[e[10]||(e[10]=t("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Nama otoritas",-1)),f(t("input",{type:"text",name:"name",id:"name","onUpdate:modelValue":e[1]||(e[1]=o=>r.form.name=o),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Nama otoritas",required:""},null,512),[[w,r.form.name]])]),t("div",null,[e[11]||(e[11]=t("label",{for:"text",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Aplikasi ",-1)),k(g,{items:r.applications,placeholder:"Cari aplikasi...","label-key":"name",modelValue:r.form.application_id,"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.application_id=o)},null,8,["items","modelValue"])]),t("div",null,[e[12]||(e[12]=t("label",{for:"code",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Kode otoritas",-1)),f(t("input",{type:"text",name:"code",id:"code","onUpdate:modelValue":e[3]||(e[3]=o=>r.form.code=o),disabled:r.id,class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Kode otoritas",required:""},null,8,B),[[w,r.form.code]])])])]),e[23]||(e[23]=t("h3",{class:"font-semibold text-gray-900 dark:text-white mt-5 mb-3"}," Menu & Aksi ",-1)),r.form.menus.length>0?(d(),u("div",H,[t("table",U,[t("thead",z,[t("tr",null,[e[13]||(e[13]=t("th",{scope:"col",class:"px-6 py-3 w-1/4"}," Menu ",-1)),(d(!0),u(p,null,b(r.actions,o=>(d(),u("th",{scope:"col",class:"px-6 py-3 text-center",key:o.id},h(o.name),1))),128)),e[14]||(e[14]=t("th",{scope:"col",class:"px-6 py-3 w-20 text-center"}," Aksi ",-1))])]),t("tbody",null,[(d(!0),u(p,null,b(r.form.menus,(o,c)=>(d(),u("tr",{key:c,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[t("td",E,[t("div",F,[t("span",O,h(s.getMenuName(o.id)),1),t("span",I,h(s.getMenuUrl(o.id)),1)])]),(d(!0),u(p,null,b(r.actions,m=>(d(),u("td",{key:m.id,class:"px-6 py-4 text-center"},[t("input",{id:`checkbox-${c}-${m.id}`,type:"checkbox",checked:s.isActionChecked(c,m.id),onChange:y=>s.handleActionToggle(c,m.id,y),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,40,Z)]))),128)),t("td",q,[t("button",{type:"button",onClick:m=>s.removeMenus(c),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"Hapus Menu"},e[15]||(e[15]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,K)])]))),128))])])])):S("",!0),t("div",L,[(d(!0),u(p,null,b(r.form.menus,(o,c)=>(d(),u("div",{key:c,class:"relative p-4 bg-white my-4 rounded-lg shadow dark:bg-gray-800 sm:p-5"},[t("div",G,[t("button",{type:"button",onClick:m=>s.removeMenus(c),class:"text-white bg-gray-300 hover:bg-gray-400 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm p-1.5 text-center inline-flex items-center me-2 dark:bg-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-800"},e[16]||(e[16]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),t("span",{class:"sr-only"},"Delete Icon",-1)]),8,P)]),t("div",W,[t("h4",J,h(s.getMenuName(o.id)),1),t("p",Q,h(s.getMenuUrl(o.id)),1)]),t("div",R,[(d(!0),u(p,null,b(r.actions,m=>(d(),u("div",{key:m.id,class:"flex items-center"},[t("input",{id:`mobile-checkbox-${c}-${m.id}`,type:"checkbox",checked:s.isActionChecked(c,m.id),onChange:y=>s.handleActionToggle(c,m.id,y),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,40,X),t("label",{for:`mobile-checkbox-${c}-${m.id}`,class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},h(m.name),9,Y)]))),128))])]))),128))]),t("div",$,[e[18]||(e[18]=t("h4",{class:"font-semibold text-gray-900 dark:text-white mb-4"},"Tambah Menu Baru",-1)),t("div",ee,[t("div",te,[e[17]||(e[17]=t("label",{for:"newMenuSelect",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Pilih Menu ",-1)),k(g,{items:s.availableMenus,placeholder:"Cari menu...","label-key":"name","value-key":"id",modelValue:r.selectedNewMenu,"onUpdate:modelValue":e[4]||(e[4]=o=>r.selectedNewMenu=o),onInput:s.handleMenuSelect},null,8,["items","modelValue","onInput"])]),t("button",{type:"button",onClick:e[5]||(e[5]=(...o)=>s.addSelectedMenu&&s.addSelectedMenu(...o)),disabled:!r.selectedNewMenu,class:"px-4 py-2.5 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"}," Tambah ",8,ie)])]),t("div",re,[t("button",{type:"button",onClick:e[6]||(e[6]=M(o=>i.$router.go(-1),["prevent"])),class:"text-gray-600 dark:text-white hover:text-white flex items-center justify-center w-full sm:w-auto border border-gray-700 dark:border-gray-500 hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:hover:bg-gray-700 dark:focus:ring-primary-800"},e[19]||(e[19]=[t("svg",{class:"mr-1 -ml-1 w-6 h-6","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},[t("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m14 8-4 4 4 4"})],-1),t("span",null,"Kembali",-1)])),f(t("button",{type:"submit",onClick:e[7]||(e[7]=o=>s.handleTypeSubmit("createNew")),class:"text-primary-600 dark:text-primary-300 hover:text-white flex items-center justify-center space-x-2 w-full sm:w-auto border border-primary-700 hover:border-primary-600 hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:hover:bg-primary-700 dark:focus:ring-primary-800"},e[20]||(e[20]=[t("svg",{class:"mr-1 -ml-1 w-6 h-6","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},[t("path",{stroke:"currentColor","stroke-linecap":"square","stroke-linejoin":"round","stroke-width":"2",d:"M16.5 15v1.5m0 0V18m0-1.5H15m1.5 0H18M3 9V6a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v3M3 9v6a1 1 0 0 0 1 1h5M3 9h16m0 0v1M6 12h3m12 4.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Z"})],-1),t("span",null,"Simpan & Buat baru",-1)]),512),[[x,!r.id]]),t("button",{type:"submit",onClick:e[8]||(e[8]=o=>s.handleTypeSubmit("create")),class:"text-white flex items-center justify-center w-full sm:w-auto bg-primary-600 hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"},[f((d(),u("svg",se,e[21]||(e[21]=[t("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"},null,-1)]),512)),[[x,!r.id]]),f((d(),u("svg",oe,e[22]||(e[22]=[t("path",{stroke:"currentColor","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 5a1 1 0 0 1 1-1h11.586a1 1 0 0 1 .707.293l2.414 2.414a1 1 0 0 1 .293.707V19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5Z"},null,-1),t("path",{stroke:"currentColor","stroke-linejoin":"round","stroke-width":"1",d:"M8 4h8v4H8V4Zm7 10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"},null,-1)]),512)),[[x,r.id]]),t("span",null,h(r.id?"Simpan perubahan":"Simpan"),1)])])])],32)])}const de=C(V,[["render",ae]]);export{de as default};
