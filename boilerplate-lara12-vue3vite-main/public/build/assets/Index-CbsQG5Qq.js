import{_ as y,G as u,o as d,a as l,b as e,f as x,j as k,v as b,K as v,F as m,m as f,t as i,k as p,n as h}from"./app-Bp1oJ4sm.js";const _={name:"QuotationIndex",data(){return{quotations:[],loading:!1,loadingPdfId:null,search:"",status:"DRAFT",pagination:{current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}}},mounted(){this.load()},methods:{async load(){this.loading=!0;try{const s={page:this.pagination.current_page,per_page:this.pagination.per_page,search:this.search,status:this.status||"DRAFT,QUOTED"},{data:t}=await u.get("/invoices",{params:s});this.quotations=t.data,this.pagination={current_page:t.current_page,last_page:t.last_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to}}catch(s){console.error("Failed to load quotations:",s),this.$emit("showToast","Failed to load quotations","error")}finally{this.loading=!1}},changePage(s){s>=1&&s<=this.pagination.last_page&&(this.pagination.current_page=s,this.load())},formatCurrency(s){return"Rp "+Number(s).toLocaleString("id-ID")},getBadgeClass(s){return{DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",QUOTED:"bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100"}[s]||"bg-gray-100 text-gray-800"},async markAsQuoted(s){var t,c;if(confirm("Mark this quotation as quoted?"))try{await u.post(`/invoices/${s}/mark-as-quoted`),this.$emit("showToast","âœ… Quotation marked as quoted","success"),this.load()}catch(n){const o=((c=(t=n.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to mark as quoted";this.$emit("showToast",o,"error")}},async convertToInvoice(s){var t,c;if(confirm("Convert this quotation to invoice?"))try{await u.post(`/invoices/${s}/mark-as-invoiced`),this.$emit("showToast","âœ… Converted to invoice successfully","success"),this.load()}catch(n){const o=((c=(t=n.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to convert to invoice";this.$emit("showToast",o,"error")}},async downloadPdf(s){this.loadingPdfId=s;try{const{data:t}=await u.get(`/invoices/${s}/pdf`,{responseType:"blob"}),c=window.URL.createObjectURL(new Blob([t])),n=document.createElement("a");n.href=c,n.setAttribute("download",`quotation-${s}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch{this.$emit("showToast","Failed to download PDF","error")}finally{this.loadingPdfId=null}}}},w={class:"p-6"},C={class:"flex justify-between mb-6"},T={class:"flex gap-4 mb-4"},D={class:"bg-white dark:bg-gray-800 rounded shadow overflow-x-auto"},I={class:"w-full"},F={key:0,class:"border-t dark:border-gray-700"},P={key:1,class:"border-t dark:border-gray-700"},Q={class:"p-3 dark:text-gray-300"},A={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},j={class:"p-3 dark:text-gray-300"},E={class:"p-3 dark:text-gray-300"},R={class:"p-3 text-right dark:text-gray-300"},S={class:"p-3 text-center"},U={class:"p-3"},B={class:"flex gap-2 justify-center"},N=["onClick"],L=["onClick"],V=["onClick"],M=["onClick"],O=["onClick","disabled"],z={key:0,class:"mt-4 flex justify-between items-center dark:text-gray-300"},G={class:"flex gap-2"},H=["disabled"],K=["disabled"];function J(s,t,c,n,o,r){return d(),l("div",w,[e("div",C,[t[8]||(t[8]=e("h1",{class:"text-2xl font-bold dark:text-white"},"Quotations",-1)),e("button",{onClick:t[0]||(t[0]=a=>s.$router.push("/app/invoices/invoices/create")),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center gap-2"},t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),x(" New Quotation ")]))]),e("div",T,[k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.search=a),onInput:t[2]||(t[2]=(...a)=>r.load&&r.load(...a)),placeholder:"Search...",class:"border dark:border-gray-600 px-3 py-2 rounded flex-1 dark:bg-gray-700 dark:text-white"},null,544),[[b,o.search]]),k(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.status=a),onChange:t[4]||(t[4]=(...a)=>r.load&&r.load(...a)),class:"border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},t[9]||(t[9]=[e("option",{value:""},"All Status",-1),e("option",{value:"DRAFT"},"Draft",-1),e("option",{value:"QUOTED"},"Quoted",-1)]),544),[[v,o.status]])]),e("div",D,[e("table",I,[t[12]||(t[12]=e("thead",{class:"bg-gray-100 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"p-3 text-left dark:text-gray-200"},"Invoice/Quote#"),e("th",{class:"p-3 text-left dark:text-gray-200"},"Date"),e("th",{class:"p-3 text-left dark:text-gray-200"},"Customer"),e("th",{class:"p-3 text-right dark:text-gray-200"},"Total"),e("th",{class:"p-3 text-center dark:text-gray-200"},"Status"),e("th",{class:"p-3 text-center dark:text-gray-200"},"Actions")])],-1)),e("tbody",null,[o.loading?(d(),l("tr",F,t[10]||(t[10]=[e("td",{colspan:"6",class:"p-4 text-center dark:text-gray-300"},"Loading...",-1)]))):o.quotations.length?(d(!0),l(m,{key:2},f(o.quotations,a=>(d(),l("tr",{key:a.id,class:"border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"},[e("td",Q,[e("div",null,i(a.quotation_number||a.invoice_number),1),a.project_name?(d(),l("div",A,i(a.project_name),1)):p("",!0)]),e("td",j,i(new Date(a.invoice_date).toLocaleDateString("id-ID")),1),e("td",E,i(a.customer_name),1),e("td",R,i(r.formatCurrency(a.total)),1),e("td",S,[e("span",{class:h([r.getBadgeClass(a.status),"px-2 py-1 rounded text-xs"])},i(a.status),3)]),e("td",U,[e("div",B,[e("button",{onClick:g=>s.$router.push(`/app/invoices/invoices/${a.id}`),class:"text-blue-600 dark:text-blue-400",title:"View"}," ðŸ‘ ",8,N),e("button",{onClick:g=>s.$router.push(`/app/invoices/invoices/${a.id}/edit`),class:"text-green-600 dark:text-green-400",title:"Edit"}," âœï¸ ",8,L),a.status==="DRAFT"?(d(),l("button",{key:0,onClick:g=>r.markAsQuoted(a.id),class:"text-purple-600 dark:text-purple-400",title:"Mark as Quoted"}," âœ… ",8,V)):p("",!0),a.status==="QUOTED"?(d(),l("button",{key:1,onClick:g=>r.convertToInvoice(a.id),class:"text-indigo-600 dark:text-indigo-400",title:"Convert to Invoice"}," ðŸ’° ",8,M)):p("",!0),e("button",{onClick:g=>r.downloadPdf(a.id),disabled:o.loadingPdfId===a.id,class:h(o.loadingPdfId===a.id?"text-gray-400 opacity-50 cursor-wait":"text-red-600 dark:text-red-400"),title:"Export PDF"},i(o.loadingPdfId===a.id?"â³":"ðŸ“„"),11,O)])])]))),128)):(d(),l("tr",P,t[11]||(t[11]=[e("td",{colspan:"6",class:"p-4 text-center text-gray-500 dark:text-gray-400"},"No quotations found",-1)])))])])]),o.pagination.total>0?(d(),l("div",z,[e("div",null," Showing "+i(o.pagination.from)+" to "+i(o.pagination.to)+" of "+i(o.pagination.total)+" entries ",1),e("div",G,[e("button",{onClick:t[5]||(t[5]=a=>r.changePage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-3 py-1 border dark:border-gray-600 rounded disabled:opacity-50 dark:bg-gray-700"}," Previous ",8,H),e("button",{onClick:t[6]||(t[6]=a=>r.changePage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-3 py-1 border dark:border-gray-600 rounded disabled:opacity-50 dark:bg-gray-700"}," Next ",8,K)])])):p("",!0)])}const X=y(_,[["render",J]]);export{X as default};
