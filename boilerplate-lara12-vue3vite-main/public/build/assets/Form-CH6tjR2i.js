import{r as U,c as T,o as b,a as v,b as t,j as d,v as i,k as C,F as P,m as B,t as m,n as N,y as W,z as X,O as Y,B as Z,G as A,C as j,h as ee,f as I,e as te,i as le}from"./app-aQX-rcOb.js";const se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},oe={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[80vh] flex flex-col"},ne={class:"p-4 border-b flex justify-between items-center bg-blue-50 rounded-t-lg"},ae={class:"flex-1 overflow-y-auto p-4"},re={class:"mb-4"},ue={key:0,class:"text-center py-8 text-gray-500"},de={class:"font-bold text-lg text-gray-700 border-b pb-1 mb-3 sticky top-0 bg-white z-10"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},ce=["onClick"],pe={class:"flex justify-between items-start"},me={class:"font-semibold text-sm"},be={key:0,class:"text-blue-600"},ve={class:"text-xs text-gray-500 mt-1"},fe={class:"text-xs font-mono mt-1 font-bold text-gray-700"},ye={class:"p-4 border-t bg-gray-50 rounded-b-lg flex justify-between items-center"},ge={class:"text-sm font-semibold text-gray-600"},xe={class:"flex gap-3"},_e=["disabled"],he={__name:"InternalItemSelector",props:{show:Boolean,items:{type:Array,default:()=>[]}},emits:["close","confirm"],setup(M,{emit:z}){const D=M,g=z,k=U(""),x=U([]),q=u=>{const a=x.value.findIndex(p=>p.id===u.id);a>=0?x.value.splice(a,1):x.value.push(u)},c=u=>x.value.some(a=>a.id===u.id),f=T(()=>{if(!k.value)return D.items;const u=k.value.toLowerCase();return D.items.filter(a=>a.name.toLowerCase().includes(u)||a.code&&a.code.toLowerCase().includes(u))}),l=T(()=>{const u={};return f.value.forEach(a=>{var $;const p=(($=a.category)==null?void 0:$.name)||"Uncategorized";u[p]||(u[p]=[]),u[p].push(a)}),u}),F=u=>new Intl.NumberFormat("id").format(u),E=()=>{const u=x.value.map(a=>{var p;return{item_id:a.id,item_code:a.code||"",item_name:a.name,area:((p=a.category)==null?void 0:p.name)||null,quantity:1,unit_price:a.price||0,discount:0}});g("confirm",u),x.value=[]};return(u,a)=>M.show?(b(),v("div",se,[t("div",oe,[t("div",ne,[a[3]||(a[3]=t("h2",{class:"text-xl font-bold text-blue-800"},"Batch Item Selection (Katalog)",-1)),t("button",{onClick:a[0]||(a[0]=p=>u.$emit("close")),class:"text-gray-500 hover:text-gray-700 text-2xl"},"Ã—")]),t("div",ae,[t("div",re,[d(t("input",{"onUpdate:modelValue":a[1]||(a[1]=p=>k.value=p),placeholder:"Search items...",class:"w-full border px-4 py-2 rounded shadow-sm focus:ring-2 focus:ring-blue-500 outline-none"},null,512),[[i,k.value]])]),Object.keys(l.value).length===0?(b(),v("div",ue," No items found. ")):C("",!0),(b(!0),v(P,null,B(l.value,(p,$)=>(b(),v("div",{key:$,class:"mb-6"},[t("h3",de,m($||"Uncategorized"),1),t("div",ie,[(b(!0),v(P,null,B(p,_=>(b(),v("div",{key:_.id,onClick:K=>q(_),class:N(["border rounded-lg p-3 cursor-pointer transition-all",c(_)?"bg-blue-100 border-blue-500 ring-1 ring-blue-500":"hover:bg-gray-50 border-gray-200"])},[t("div",pe,[t("div",me,m(_.name),1),c(_)?(b(),v("div",be,"âœ“")):C("",!0)]),t("div",ve,m(_.code||"-"),1),t("div",fe," Rp "+m(F(_.price)),1)],10,ce))),128))])]))),128))]),t("div",ye,[t("div",ge,m(x.value.length)+" key items selected ",1),t("div",xe,[t("button",{onClick:a[2]||(a[2]=p=>u.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100 transition-colors"}," Cancel "),t("button",{onClick:E,class:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors shadow-sm font-medium",disabled:x.value.length===0}," Add Selected Items ",8,_e)])])])])):C("",!0)}},we={class:"p-6"},ke={class:"text-2xl font-bold mb-6"},Ie={class:"grid grid-cols-3 gap-4"},Ce=["readonly","disabled","placeholder"],$e={key:0,class:"text-xs text-gray-500 mt-1"},Ve={key:0,class:"text-red-600 text-xs mt-1"},Ue={class:"col-span-2"},qe={key:0,class:"text-red-600 text-xs mt-1"},je={class:"flex justify-between items-end mb-2"},Se={key:0,class:"mb-2 p-3 bg-red-50 border border-red-600 rounded text-red-700 text-sm"},Ae={class:"col-span-2 relative"},Ne=["onUpdate:modelValue","onFocus"],Te={key:0,class:"absolute top-full left-0 right-0 mt-1 border border-gray-300 bg-white rounded z-10 max-h-48 overflow-y-auto shadow-lg"},De=["onClick"],Fe={class:"font-semibold text-gray-800"},Oe={class:"text-xs text-gray-500"},Pe=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],ze=["onUpdate:modelValue"],Ee=["onUpdate:modelValue"],Le={class:"flex gap-1"},Re={class:"border border-gray-300 px-2 py-1 rounded bg-gray-100 text-sm flex-1"},Ke=["onClick"],Qe={class:"grid grid-cols-3 gap-4"},Ge={class:"border px-3 py-2 rounded w-full bg-blue-50 text-sm"},He={class:"grid grid-cols-2 gap-4"},Je={class:"text-right text-xl font-bold"},We={class:"flex gap-4 justify-end"},Ye={__name:"Form",setup(M){const z=W(),D=X(),g=z.params.id,k=U(null),x=U([]),q=U(!1),c=U({}),f=Y({}),l=U({invoice_number:"",invoice_date:new Date().toISOString().split("T")[0],currency_name:"Indonesian Rupiah",notes:"",terbilang:"",prepared_by:"",approved_by:"",customer_name:"",customer_address:"",payment_terms:"",expedition:"",po_number:"",discount:0,ppn_percent:0,other_charges:0,items:[{item_id:null,item_code:"",item_name:"",area:"",quantity:1,unit_price:0,discount:0}]}),F=T(()=>{const e=l.value.items.reduce((r,n)=>r+((n.quantity||0)*(n.unit_price||0)-(n.discount||0)),0)-(l.value.discount||0),o=e*(l.value.ppn_percent||0)/100;return e+o+(l.value.other_charges||0)}),E=T(()=>l.value.items.reduce((s,e)=>s+((e.quantity||0)*(e.unit_price||0)-(e.discount||0)),0)),u=s=>new Intl.NumberFormat("id").format(s),a=T(()=>p(Math.round(F.value)));function p(s){if(!s&&s!==0)return"";if(s=Math.round(s),s<0&&(s=Math.abs(s)),s===0)return"nol rupiah";const e=["","satu","dua","tiga","empat","lima","enam","tujuh","delapan","sembilan"],o=["","","dua puluh","tiga puluh","empat puluh","lima puluh","enam puluh","tujuh puluh","delapan puluh","sembilan puluh"],r=["sepuluh","sebelas","dua belas","tiga belas","empat belas","lima belas","enam belas","tujuh belas","delapan belas","sembilan belas"],n=["","ribu","juta","milyar"];function L(w){if(w===0)return"";let y="";const R=Math.floor(w/100),O=Math.floor(w%100/10),S=w%10;return R>0&&(R===1?y+="seratus":y+=e[R]+" ratus"),O===0&&S>0?(y&&(y+=" "),y+=e[S]):O===1?(y&&(y+=" "),y+=r[S]):O>1&&(y&&(y+=" "),y+=o[O],S>0&&(y+=" "+e[S])),y}let h=[],V=0;for(;s>0&&V<n.length;){const w=s%1e3;if(w>0){let y=L(w);V===1&&w===1?h.unshift("seribu"):V===2&&w===1?h.unshift("satu juta"):V===3&&w===1?h.unshift("satu milyar"):n[V]?h.unshift(y+" "+n[V]):h.unshift(y)}s=Math.floor(s/1e3),V++}return h.join(" ")+" rupiah"}const $=async()=>{if(c.value={},l.value.invoice_date||(c.value.invoice_date="Invoice Date is required"),(!l.value.customer_name||l.value.customer_name.trim()==="")&&(c.value.customer_name="Customer name is required"),!l.value.items||l.value.items.length===0?c.value.items="At least one item is required":l.value.items.filter(h=>!h.item_id||!h.quantity||!h.unit_price).length>0&&(c.value.items="Please fill in: Item Selection, Quantity, and Price for all items"),Object.keys(c.value).length>0){window.scrollTo({top:0,behavior:"smooth"}),alert("âŒ Please fill in all required fields (marked with *)");return}const s=E.value,e=s-(l.value.discount||0),o=e*(l.value.ppn_percent||0)/100,r=e+o+(l.value.other_charges||0),n={...l.value,invoice_date:Q(l.value.invoice_date),subtotal:s,discount:l.value.discount||0,ppn_percent:l.value.ppn_percent||0,ppn_amount:o,other_charges:l.value.other_charges||0,total:r,terbilang:p(Math.round(r))};g?await A.put(`invoices/${g}`,n):await A.post("invoices",{...n,invoice_number:l.value.invoice_number||null}),D.push("/app/invoices/invoices")},_=s=>{const e=(f[s]||"").toLowerCase();return e?x.value.filter(o=>o.name.toLowerCase().includes(e)||o.code&&o.code.toLowerCase().includes(e)).slice(0,10):[]},K=(s,e)=>{var o;l.value.items[s].item_id=e.id,l.value.items[s].item_code=e.code||"",l.value.items[s].item_name=e.name,l.value.items[s].area=((o=e.category)==null?void 0:o.name)||"",l.value.items[s].unit_price=e.price||0,l.value.items[s].quantity===1&&(l.value.items[s].quantity=e.quantity||1),f[s]=""},G=()=>{const s=l.value.items.length;l.value.items.push({item_id:null,item_code:"",item_name:"",area:"",quantity:1,unit_price:0,discount:0}),f[s]=""},H=s=>{l.value.items.length===1&&!l.value.items[0].item_id&&!l.value.items[0].item_name&&(l.value.items=[]),s.forEach(e=>{l.value.items.push(e)}),q.value=!1},J=s=>{l.value.items.splice(s,1);const e={};Object.keys(f).forEach(o=>{const r=parseInt(o);r<s?e[r]=f[r]:r>s&&(e[r-1]=f[r])}),Object.keys(f).forEach(o=>delete f[o]),Object.assign(f,e)},Q=s=>s?s.includes("T")?s.split("T")[0]:s:"";return Z(async()=>{try{const s=await A.get("items?per_page=500");x.value=Array.isArray(s.data)?s.data:s.data.data||s.data}catch(s){console.warn("Could not load master items:",s)}if(g){const s=await A.get(`invoices/${g}`);s.invoice_date&&(s.invoice_date=Q(s.invoice_date)),l.value=s}else try{const s=await A.get("invoices/next-number");k.value=s.next_number,l.value.invoice_number=s.next_number}catch(s){console.warn("Could not fetch next invoice number:",s)}}),(s,e)=>(b(),v("div",we,[t("h1",ke,m(j(g)?"Edit":"New")+" Invoice ",1),e[41]||(e[41]=ee('<div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded flex items-start gap-2"><div class="text-sm"><span class="font-semibold">Tanda: <span class="text-red-600 font-bold text-lg">*</span> = Field wajib diisi</span><p class="text-xs text-gray-600 mt-1">Pastikan semua field yang ditandai sudah terisi sebelum menyimpan.</p></div></div>',1)),t("form",{onSubmit:le($,["prevent"]),class:"bg-white p-6 rounded shadow space-y-6"},[t("div",Ie,[t("div",null,[e[17]||(e[17]=t("label",{class:"block mb-1"},"Invoice #",-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.invoice_number=o),readonly:!j(g),disabled:!j(g),placeholder:j(g)?"":"Auto-generated",class:N([j(g)?"":"bg-gray-100 cursor-not-allowed","border px-3 py-2 rounded w-full"])},null,10,Ce),[[i,l.value.invoice_number]]),!j(g)&&k.value?(b(),v("div",$e," Next: "+m(k.value),1)):C("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-1"},[I("Invoice Date "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.invoice_date=o),type:"date",required:"",class:N(["border px-3 py-2 rounded w-full",c.value.invoice_date?"border-red-600 bg-red-50":"border-gray-300"])},null,2),[[i,l.value.invoice_date]]),c.value.invoice_date?(b(),v("div",Ve,m(c.value.invoice_date),1)):C("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1"},"Currency",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.currency_name=o),class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.currency_name]])]),t("div",Ue,[e[20]||(e[20]=t("label",{class:"block mb-1"},[I("Customer "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.customer_name=o),required:"",class:N(["border px-3 py-2 rounded w-full",c.value.customer_name?"border-red-600 bg-red-50":"border-gray-300"])},null,2),[[i,l.value.customer_name]]),c.value.customer_name?(b(),v("div",qe,m(c.value.customer_name),1)):C("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-1"},"PO Number",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.po_number=o),class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.po_number]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block mb-1"},"Address",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.customer_address=o),class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.customer_address]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1"},"Payment Terms",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.payment_terms=o),placeholder:"eg: COD",class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.payment_terms]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block mb-1"},"Expedition",-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.expedition=o),class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.expedition]])])]),t("div",null,[t("div",je,[e[26]||(e[26]=t("h3",{class:"font-bold"},[I("Items "),t("span",{class:"text-red-600 font-bold"},"*"),I(" (At least 1 item required)")],-1)),t("button",{type:"button",onClick:e[8]||(e[8]=o=>q.value=!0),class:"text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 flex items-center gap-1"},e[25]||(e[25]=[t("span",null,"ðŸ“š",-1),I(" Ambil dari Katalog (Batch) ")]))]),c.value.items?(b(),v("div",Se," âš ï¸ "+m(c.value.items),1)):C("",!0),(b(!0),v(P,null,B(l.value.items,(o,r)=>(b(),v("div",{key:r,class:"grid grid-cols-8 gap-2 mb-2 items-end"},[t("div",Ae,[e[27]||(e[27]=t("label",{class:"block text-xs"},[I("Select Item "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),d(t("input",{"onUpdate:modelValue":n=>f[r]=n,type:"text",placeholder:"Search item...",onFocus:n=>f[r]=f[r]||"",class:N(["border px-2 py-1 rounded w-full text-sm",!o.item_id&&Object.keys(c.value).length>0?"border-red-600 bg-red-50":"border-gray-300"])},null,42,Ne),[[i,f[r]]]),f[r]&&_(r).length>0?(b(),v("div",Te,[(b(!0),v(P,null,B(_(r),n=>(b(),v("div",{key:n.id,onClick:L=>K(r,n),class:"px-2 py-2 hover:bg-blue-100 cursor-pointer text-sm border-b border-gray-200 last:border-b-0"},[t("div",Fe,m(n.name),1),t("div",Oe,m(n.code)+" â€¢ "+m(n.unit)+" â€¢ Rp "+m(u(n.price)),1)],8,De))),128))])):C("",!0)]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs"},"Area",-1)),d(t("input",{"onUpdate:modelValue":n=>o.area=n,class:"border border-gray-300 px-2 py-1 rounded w-full text-sm bg-gray-50",placeholder:"Area"},null,8,Pe),[[i,o.area]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-xs"},"Code",-1)),d(t("input",{"onUpdate:modelValue":n=>o.item_code=n,class:"border border-gray-300 px-2 py-1 rounded w-full text-sm"},null,8,Be),[[i,o.item_code]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-xs"},[I("Qty "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),d(t("input",{"onUpdate:modelValue":n=>o.quantity=n,type:"number",required:"",class:"border px-2 py-1 rounded w-full text-sm"},null,8,Me),[[i,o.quantity,void 0,{number:!0}]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-xs"},[I("Price "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),d(t("input",{"onUpdate:modelValue":n=>o.unit_price=n,type:"number",required:"",class:"border px-2 py-1 rounded w-full text-sm"},null,8,ze),[[i,o.unit_price,void 0,{number:!0}]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-xs"},"Disc",-1)),d(t("input",{"onUpdate:modelValue":n=>o.discount=n,type:"number",class:"border border-gray-300 px-2 py-1 rounded w-full text-sm"},null,8,Ee),[[i,o.discount,void 0,{number:!0}]])]),t("div",Le,[t("span",Re,m(u((o.quantity||0)*(o.unit_price||0)-(o.discount||0))),1),t("button",{type:"button",onClick:n=>J(r),class:"text-red-600 hover:text-red-800"},"ðŸ—‘",8,Ke)])]))),128)),t("button",{type:"button",onClick:G,class:"text-blue-600 text-sm hover:text-blue-800"}," + Add Single Item ")]),te(he,{show:q.value,items:x.value,onClose:e[9]||(e[9]=o=>q.value=!1),onConfirm:H},null,8,["show","items"]),t("div",Qe,[t("div",null,[e[33]||(e[33]=t("label",{class:"block mb-1"},"Discount",-1)),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>l.value.discount=o),type:"number",class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.discount,void 0,{number:!0}]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block mb-1"},"PPN %",-1)),d(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>l.value.ppn_percent=o),type:"number",class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.ppn_percent,void 0,{number:!0}]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block mb-1"},"Other Charges",-1)),d(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>l.value.other_charges=o),type:"number",class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.other_charges,void 0,{number:!0}]])])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block mb-1"},"Terbilang (amount in words) - Auto-calculated from total",-1)),t("div",Ge,m(a.value),1)]),t("div",He,[t("div",null,[e[37]||(e[37]=t("label",{class:"block mb-1"},"Prepared By",-1)),d(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>l.value.prepared_by=o),class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.prepared_by]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block mb-1"},"Approved By",-1)),d(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>l.value.approved_by=o),class:"border px-3 py-2 rounded w-full"},null,512),[[i,l.value.approved_by]])])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block mb-1"},"Notes / Keterangan",-1)),d(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=o=>l.value.notes=o),class:"border px-3 py-2 rounded w-full",rows:"4"},null,512),[[i,l.value.notes]])]),t("div",Je," Total: "+m(u(F.value)),1),t("div",We,[t("button",{type:"button",onClick:e[16]||(e[16]=o=>s.$router.push("/app/invoices/invoices")),class:"px-4 py-2 border rounded"}," Cancel "),e[40]||(e[40]=t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded"}," Save ",-1))])],32)]))}};export{Ye as default};
