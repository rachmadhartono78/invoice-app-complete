import{_ as f,G as d,o as l,a as m,b as t,t as a,f as u,j as i,K as g,F as v,m as h,k,v as p,h as x,i as I}from"./app-B6zZeFFz.js";const _={name:"PaymentForm",data(){return{loading:!1,isEdit:!1,paymentId:null,unpaidInvoices:[],selectedInvoice:null,form:{invoice_id:"",payment_date:new Date().toISOString().split("T")[0],amount:0,payment_method:"bank_transfer",reference_number:"",notes:""}}},mounted(){this.paymentId=this.$route.params.id,this.isEdit=!!this.paymentId,this.isEdit?this.loadPayment():this.loadUnpaidInvoices()},methods:{async loadUnpaidInvoices(){try{const{data:r}=await d.get("/invoices",{params:{status:"INVOICED,PARTIAL_PAID",per_page:100}});this.unpaidInvoices=r.data.map(e=>({...e,remaining_balance:e.total-(e.paid_amount||0)}))}catch(r){console.error("Failed to load invoices:",r)}},async loadPayment(){this.loading=!0;try{const{data:r}=await d.get(`/payments/${this.paymentId}`);this.form={invoice_id:r.invoice_id,payment_date:r.payment_date,amount:r.amount,payment_method:r.payment_method,reference_number:r.reference_number||"",notes:r.notes||""},this.selectedInvoice=r.invoice}catch(r){console.error("Failed to load payment:",r),this.$emit("showToast","Failed to load payment","error"),this.$router.push("/app/invoices/payments")}finally{this.loading=!1}},onInvoiceChange(){this.selectedInvoice=this.unpaidInvoices.find(r=>r.id===parseInt(this.form.invoice_id)),this.selectedInvoice&&(this.form.amount=this.selectedInvoice.remaining_balance)},formatCurrency(r){return"Rp "+Number(r).toLocaleString("id-ID")},async submit(){var r,e;this.loading=!0;try{this.isEdit?(await d.put(`/payments/${this.paymentId}`,this.form),this.$emit("showToast","✅ Payment updated successfully","success")):(await d.post("/payments",this.form),this.$emit("showToast","✅ Payment recorded successfully","success")),this.$router.push("/app/invoices/payments")}catch(c){const y=((e=(r=c.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to save payment";this.$emit("showToast",y,"error")}finally{this.loading=!1}}}},w={class:"p-6 max-w-4xl mx-auto"},C={class:"mb-6"},P={class:"text-2xl font-bold dark:text-white"},V={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},E={class:"md:col-span-2"},T=["disabled"],S=["value"],U={key:0,class:"mt-2 p-3 bg-blue-50 dark:bg-blue-900 rounded text-sm dark:text-gray-200"},D={class:"font-bold"},F=["max"],N={class:"md:col-span-2"},R={class:"flex gap-4 mt-6"},A=["disabled"];function B(r,e,c,y,o,n){var b;return l(),m("div",w,[t("div",C,[t("h1",P,a(o.isEdit?"Edit Payment":"Record Payment"),1)]),t("form",{onSubmit:e[8]||(e[8]=I((...s)=>n.submit&&n.submit(...s),["prevent"])),class:"bg-white dark:bg-gray-800 rounded shadow p-6"},[t("div",V,[t("div",E,[e[11]||(e[11]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Invoice "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.invoice_id=s),onChange:e[1]||(e[1]=(...s)=>n.onInvoiceChange&&n.onInvoiceChange(...s)),required:"",disabled:o.isEdit,class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},[e[9]||(e[9]=t("option",{value:""},"Select Invoice",-1)),(l(!0),m(v,null,h(o.unpaidInvoices,s=>(l(),m("option",{key:s.id,value:s.id},a(s.invoice_number)+" - "+a(s.customer_name)+" (Remaining: "+a(n.formatCurrency(s.remaining_balance))+") ",9,S))),128))],40,T),[[g,o.form.invoice_id]]),o.selectedInvoice?(l(),m("div",U,[e[10]||(e[10]=t("div",{class:"font-medium"},"Invoice Details:",-1)),t("div",null,"Total: "+a(n.formatCurrency(o.selectedInvoice.total)),1),t("div",null,"Paid: "+a(n.formatCurrency(o.selectedInvoice.paid_amount||0)),1),t("div",D,"Remaining: "+a(n.formatCurrency(o.selectedInvoice.remaining_balance)),1)])):k("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Payment Date "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.payment_date=s),type:"date",required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},null,512),[[p,o.form.payment_date]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Amount "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.amount=s),type:"number",step:"0.01",min:"0",max:(b=o.selectedInvoice)==null?void 0:b.remaining_balance,required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"0.00"},null,8,F),[[p,o.form.amount]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.payment_method=s),required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},e[14]||(e[14]=[x('<option value="cash">Cash</option><option value="bank_transfer">Bank Transfer</option><option value="check">Check</option><option value="giro">Giro</option><option value="credit_card">Credit Card</option><option value="other">Other</option>',6)]),512),[[g,o.form.payment_method]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},"Reference Number",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.reference_number=s),type:"text",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"Bank ref, check number, etc"},null,512),[[p,o.form.reference_number]])]),t("div",N,[e[17]||(e[17]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},"Notes",-1)),i(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.notes=s),rows:"3",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"Additional notes..."},null,512),[[p,o.form.notes]])])]),t("div",R,[t("button",{type:"submit",disabled:o.loading,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50"},a(o.loading?"Saving...":o.isEdit?"Update":"Record Payment"),9,A),t("button",{type:"button",onClick:e[7]||(e[7]=s=>r.$router.push("/app/invoices/payments")),class:"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 px-6 py-2 rounded dark:text-white"}," Cancel ")])],32)])}const M=f(_,[["render",B]]);export{M as default};
