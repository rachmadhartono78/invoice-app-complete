import{_ as f,G as m,o as a,c as d,a as t,t as r,k as y,i as h,h as u,e as l,K as v,F as k,l as x,j as p,f as w}from"./app-C0aBAvKS.js";const I={name:"PaymentForm",data(){return{loading:!1,isEdit:!1,paymentId:null,unpaidInvoices:[],selectedInvoice:null,form:{invoice_id:"",payment_date:new Date().toISOString().split("T")[0],amount:0,payment_method:"bank_transfer",reference_number:"",notes:""}}},mounted(){this.paymentId=this.$route.params.id,this.isEdit=!!this.paymentId,this.isEdit?this.loadPayment():this.loadUnpaidInvoices()},methods:{async loadUnpaidInvoices(){this.loading=!0;try{const{data:s}=await m.get("/invoices/unpaid");this.unpaidInvoices=Array.isArray(s)?s:[],console.log("Loaded unpaid invoices:",this.unpaidInvoices.length)}catch(s){console.error("Failed to load invoices:",s),this.$emit("showToast","Failed to load invoices","error")}finally{this.loading=!1}},async loadPayment(){this.loading=!0;try{const{data:s}=await m.get(`/payments/${this.paymentId}`);this.form={invoice_id:s.invoice_id,payment_date:s.payment_date,amount:s.amount,payment_method:s.payment_method,reference_number:s.reference_number||"",notes:s.notes||""},this.selectedInvoice=s.invoice}catch(s){console.error("Failed to load payment:",s),this.$emit("showToast","Failed to load payment","error"),this.$router.push({name:"payments-index"})}finally{this.loading=!1}},onInvoiceChange(){this.selectedInvoice=this.unpaidInvoices.find(s=>s.id===parseInt(this.form.invoice_id)),this.selectedInvoice&&(this.form.amount=this.selectedInvoice.remaining_balance)},formatCurrency(s){return"Rp "+Number(s).toLocaleString("id-ID")},async submit(){var s,e;this.loading=!0;try{this.isEdit?(await m.put(`/payments/${this.paymentId}`,this.form),this.$emit("showToast","âœ… Payment updated successfully","success")):(await m.post("/payments",this.form),this.$emit("showToast","âœ… Payment recorded successfully","success")),this.$router.push({name:"payments-index"})}catch(c){const b=((e=(s=c.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to save payment";this.$emit("showToast",b,"error")}finally{this.loading=!1}}}},_={class:"p-6 max-w-4xl mx-auto"},C={class:"mb-6"},E={class:"text-2xl font-bold dark:text-white"},P={key:0,class:"bg-white dark:bg-gray-800 rounded shadow p-6"},S={key:1,class:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded shadow p-6"},T={class:"flex items-start gap-4"},V={class:"flex-1"},F={class:"flex gap-3"},U={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},D={class:"md:col-span-2"},A=["disabled"],N=["value"],R={key:0,class:"mt-2 p-3 bg-blue-50 dark:bg-blue-900 rounded text-sm dark:text-gray-200"},B={class:"font-bold"},L=["max"],q={class:"md:col-span-2"},M={class:"flex gap-4 mt-6"},G=["disabled"];function K(s,e,c,b,o,n){var g;return a(),d("div",_,[t("div",C,[t("h1",E,r(o.isEdit?"Edit Payment":"Record Payment"),1)]),o.loading&&!o.isEdit&&!o.unpaidInvoices.length?(a(),d("div",P,e[11]||(e[11]=[t("div",{class:"text-center py-8"},[t("div",{class:"text-gray-500 dark:text-gray-400"},"Loading invoices...")],-1)]))):!o.isEdit&&!o.unpaidInvoices.length&&!o.loading?(a(),d("div",S,[t("div",T,[e[14]||(e[14]=t("div",{class:"text-4xl flex-shrink-0"},"ðŸ“",-1)),t("div",V,[e[12]||(e[12]=t("h2",{class:"text-lg font-bold text-yellow-800 dark:text-yellow-400 mb-2"},"Tidak Ada Invoice untuk Dibayar",-1)),e[13]||(e[13]=t("p",{class:"text-sm text-yellow-700 dark:text-yellow-300 mb-4"}," Semua invoice sudah terbayar lunas atau tidak ada invoice yang dalam status pending pembayaran. Silahkan periksa kembali status invoice Anda. ",-1)),t("div",F,[t("button",{onClick:e[0]||(e[0]=i=>s.$router.push({name:"invoices-index"})),class:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded text-sm font-semibold transition-colors"}," Lihat Daftar Invoice "),t("button",{onClick:e[1]||(e[1]=i=>s.$router.push({name:"payments-index"})),class:"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-700 text-gray-800 dark:text-white px-4 py-2 rounded text-sm font-semibold transition-colors"}," Kembali ")])])])])):y("",!0),o.isEdit||o.unpaidInvoices.length>0?(a(),d("form",{key:2,onSubmit:e[10]||(e[10]=h((...i)=>n.submit&&n.submit(...i),["prevent"])),class:"bg-white dark:bg-gray-800 rounded shadow p-6"},[t("div",U,[t("div",D,[e[17]||(e[17]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Invoice "),t("span",{class:"text-red-500"},"*")],-1)),l(t("select",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.invoice_id=i),onChange:e[3]||(e[3]=(...i)=>n.onInvoiceChange&&n.onInvoiceChange(...i)),required:"",disabled:o.isEdit,class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},[e[15]||(e[15]=t("option",{value:""},"Select Invoice",-1)),(a(!0),d(k,null,x(o.unpaidInvoices,i=>(a(),d("option",{key:i.id,value:i.id},r(i.invoice_number)+" - "+r(i.customer_name)+" (Remaining: "+r(n.formatCurrency(i.remaining_balance))+") ",9,N))),128))],40,A),[[v,o.form.invoice_id]]),o.selectedInvoice?(a(),d("div",R,[e[16]||(e[16]=t("div",{class:"font-medium"},"Invoice Details:",-1)),t("div",null,"Total: "+r(n.formatCurrency(o.selectedInvoice.total)),1),t("div",null,"Paid: "+r(n.formatCurrency(o.selectedInvoice.paid_amount||0)),1),t("div",B,"Remaining: "+r(n.formatCurrency(o.selectedInvoice.remaining_balance)),1)])):y("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Payment Date "),t("span",{class:"text-red-500"},"*")],-1)),l(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.payment_date=i),type:"date",required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},null,512),[[p,o.form.payment_date]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Amount "),t("span",{class:"text-red-500"},"*")],-1)),l(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>o.form.amount=i),type:"number",step:"0.01",min:"0",max:(g=o.selectedInvoice)==null?void 0:g.remaining_balance,required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"0.00"},null,8,L),[[p,o.form.amount]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},[u("Payment Method "),t("span",{class:"text-red-500"},"*")],-1)),l(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>o.form.payment_method=i),required:"",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},e[20]||(e[20]=[w('<option value="cash">Cash</option><option value="bank_transfer">Bank Transfer</option><option value="check">Check</option><option value="giro">Giro</option><option value="credit_card">Credit Card</option><option value="other">Other</option>',6)]),512),[[v,o.form.payment_method]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},"Reference Number",-1)),l(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.reference_number=i),type:"text",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"Bank ref, check number, etc"},null,512),[[p,o.form.reference_number]])]),t("div",q,[e[23]||(e[23]=t("label",{class:"block mb-2 font-medium dark:text-gray-200"},"Notes",-1)),l(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.notes=i),rows:"3",class:"w-full border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white",placeholder:"Additional notes..."},null,512),[[p,o.form.notes]])])]),t("div",M,[t("button",{type:"submit",disabled:o.loading||!o.form.invoice_id,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed"},r(o.loading?"Saving...":o.isEdit?"Update":"Record Payment"),9,G),t("button",{type:"button",onClick:e[9]||(e[9]=i=>s.$router.push({name:"payments-index"})),class:"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 px-6 py-2 rounded dark:text-white"}," Cancel ")])],32)):y("",!0)])}const j=f(I,[["render",K]]);export{j as default};
