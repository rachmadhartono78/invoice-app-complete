import{y as K,z as H,r as I,O as J,c as T,B as W,G as V,o as b,a as c,b as t,t as m,C as w,h as X,j as u,v as r,n as h,k as g,f as _,F as M,m as S,i as Y}from"./app-B6zZeFFz.js";const Z={class:"p-6"},ee={class:"text-2xl font-bold mb-6"},te={class:"grid grid-cols-3 gap-4"},le=["readonly","disabled","placeholder"],se={key:0,class:"text-xs text-gray-500 mt-1"},oe={key:0,class:"text-red-600 text-xs mt-1"},ne={class:"col-span-2"},ae={key:0,class:"text-red-600 text-xs mt-1"},ue={key:0,class:"mb-2 p-3 bg-red-50 border border-red-600 rounded text-red-700 text-sm"},re={class:"relative"},de=["onUpdate:modelValue","onFocus"],ie={key:0,class:"absolute top-full left-0 right-0 mt-1 border border-gray-300 bg-white rounded z-10 max-h-48 overflow-y-auto shadow-lg"},pe=["onClick"],me={class:"font-semibold text-gray-800"},be={class:"text-xs text-gray-500"},ce={key:1,class:"absolute top-full left-0 right-0 mt-1 border border-gray-300 bg-white rounded z-10 px-2 py-2 text-xs text-gray-500 shadow-lg"},ve={key:2,class:"text-xs text-blue-600 mt-1"},ye=["onUpdate:modelValue"],fe=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],we={class:"flex gap-1"},he={class:"border border-gray-300 px-2 py-1 rounded bg-gray-100 text-sm flex-1"},ke=["onClick"],Ve={class:"grid grid-cols-3 gap-4"},Ue={class:"border px-3 py-2 rounded w-full bg-blue-50 text-sm"},Ie={class:"grid grid-cols-2 gap-4"},qe={class:"text-right text-xl font-bold"},Ce={class:"flex gap-4 justify-end"},Oe={__name:"Form",setup(je){const B=K(),$=H(),v=B.params.id,q=I(null),A=I([]),d=I({}),p=J({}),s=I({invoice_number:"",invoice_date:new Date().toISOString().split("T")[0],currency_name:"Indonesian Rupiah",notes:"",terbilang:"",prepared_by:"",approved_by:"",customer_name:"",customer_address:"",payment_terms:"",expedition:"",po_number:"",discount:0,ppn_percent:0,other_charges:0,items:[{item_id:null,item_code:"",item_name:"",quantity:1,unit_price:0,discount:0}]}),D=T(()=>{const e=s.value.items.reduce((a,n)=>a+((n.quantity||0)*(n.unit_price||0)-(n.discount||0)),0)-(s.value.discount||0),l=e*(s.value.ppn_percent||0)/100;return e+l+(s.value.other_charges||0)}),E=T(()=>s.value.items.reduce((o,e)=>o+((e.quantity||0)*(e.unit_price||0)-(e.discount||0)),0)),C=o=>new Intl.NumberFormat("id").format(o),z=T(()=>P(Math.round(D.value)));function P(o){if(!o&&o!==0)return"";if(o=Math.round(o),o<0&&(o=Math.abs(o)),o===0)return"nol rupiah";const e=["","satu","dua","tiga","empat","lima","enam","tujuh","delapan","sembilan"],l=["","","dua puluh","tiga puluh","empat puluh","lima puluh","enam puluh","tujuh puluh","delapan puluh","sembilan puluh"],a=["sepuluh","sebelas","dua belas","tiga belas","empat belas","lima belas","enam belas","tujuh belas","delapan belas","sembilan belas"],n=["","ribu","juta","milyar"];function N(f){if(f===0)return"";let i="";const O=Math.floor(f/100),U=Math.floor(f%100/10),k=f%10;return O>0&&(O===1?i+="seratus":i+=e[O]+" ratus"),U===0&&k>0?(i&&(i+=" "),i+=e[k]):U===1?(i&&(i+=" "),i+=a[k]):U>1&&(i&&(i+=" "),i+=l[U],k>0&&(i+=" "+e[k])),i}let y=[],x=0;for(;o>0&&x<n.length;){const f=o%1e3;if(f>0){let i=N(f);x===1&&f===1?y.unshift("seribu"):x===2&&f===1?y.unshift("satu juta"):x===3&&f===1?y.unshift("satu milyar"):n[x]?y.unshift(i+" "+n[x]):y.unshift(i)}o=Math.floor(o/1e3),x++}return y.join(" ")+" rupiah"}const L=async()=>{if(d.value={},s.value.invoice_date||(d.value.invoice_date="Invoice Date is required"),(!s.value.customer_name||s.value.customer_name.trim()==="")&&(d.value.customer_name="Customer name is required"),!s.value.items||s.value.items.length===0?d.value.items="At least one item is required":s.value.items.filter(y=>!y.item_id||!y.quantity||!y.unit_price).length>0&&(d.value.items="Please fill in: Item Selection, Quantity, and Price for all items"),Object.keys(d.value).length>0){window.scrollTo({top:0,behavior:"smooth"}),alert("âŒ Please fill in all required fields (marked with *)");return}const o=E.value,e=o-(s.value.discount||0),l=e*(s.value.ppn_percent||0)/100,a=e+l+(s.value.other_charges||0),n={...s.value,invoice_date:F(s.value.invoice_date),subtotal:o,discount:s.value.discount||0,ppn_percent:s.value.ppn_percent||0,ppn_amount:l,other_charges:s.value.other_charges||0,total:a,terbilang:P(Math.round(a))};v?await V.put(`invoices/${v}`,n):await V.post("invoices",{...n,invoice_number:s.value.invoice_number||null}),$.push("/app/invoices/invoices")},j=o=>{const e=(p[o]||"").toLowerCase();return e?A.value.filter(l=>l.name.toLowerCase().includes(e)||l.code&&l.code.toLowerCase().includes(e)).slice(0,10):[]},R=(o,e)=>{s.value.items[o].item_id=e.id,s.value.items[o].item_code=e.code||"",s.value.items[o].item_name=e.name,s.value.items[o].unit_price=e.price||0,s.value.items[o].quantity===1&&(s.value.items[o].quantity=e.quantity||1),p[o]=""},Q=()=>{const o=s.value.items.length;s.value.items.push({item_id:null,item_code:"",item_name:"",quantity:1,unit_price:0,discount:0}),p[o]=""},G=o=>{s.value.items.splice(o,1);const e={};Object.keys(p).forEach(l=>{const a=parseInt(l);a<o?e[a]=p[a]:a>o&&(e[a-1]=p[a])}),Object.keys(p).forEach(l=>delete p[l]),Object.assign(p,e)},F=o=>o?o.includes("T")?o.split("T")[0]:o:"";return W(async()=>{try{const o=await V.get("items?per_page=100");A.value=Array.isArray(o.data)?o.data:o.data.data||o.data}catch(o){console.warn("Could not load master items:",o)}if(v){const o=await V.get(`invoices/${v}`);o.invoice_date&&(o.invoice_date=F(o.invoice_date)),s.value=o}else try{const o=await V.get("invoices/next-number");q.value=o.next_number,s.value.invoice_number=o.next_number}catch(o){console.warn("Could not fetch next invoice number:",o)}}),(o,e)=>(b(),c("div",Z,[t("h1",ee,m(w(v)?"Edit":"New")+" Invoice ",1),e[38]||(e[38]=X('<div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded flex items-start gap-2"><div class="text-sm"><span class="font-semibold">Tanda: <span class="text-red-600 font-bold text-lg">*</span> = Field wajib diisi</span><p class="text-xs text-gray-600 mt-1">Pastikan semua field yang ditandai sudah terisi sebelum menyimpan.</p></div></div>',1)),t("form",{onSubmit:Y(L,["prevent"]),class:"bg-white p-6 rounded shadow space-y-6"},[t("div",te,[t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-1"},"Invoice #",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.invoice_number=l),readonly:!w(v),disabled:!w(v),placeholder:w(v)?"":"Auto-generated",class:h([w(v)?"":"bg-gray-100 cursor-not-allowed","border px-3 py-2 rounded w-full"])},null,10,le),[[r,s.value.invoice_number]]),!w(v)&&q.value?(b(),c("div",se," Next: "+m(q.value),1)):g("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-1"},[_("Invoice Date "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.invoice_date=l),type:"date",required:"",class:h(["border px-3 py-2 rounded w-full",d.value.invoice_date?"border-red-600 bg-red-50":"border-gray-300"])},null,2),[[r,s.value.invoice_date]]),d.value.invoice_date?(b(),c("div",oe,m(d.value.invoice_date),1)):g("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block mb-1"},"Currency",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.currency_name=l),class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.currency_name]])]),t("div",ne,[e[18]||(e[18]=t("label",{class:"block mb-1"},[_("Customer "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.customer_name=l),required:"",class:h(["border px-3 py-2 rounded w-full",d.value.customer_name?"border-red-600 bg-red-50":"border-gray-300"])},null,2),[[r,s.value.customer_name]]),d.value.customer_name?(b(),c("div",ae,m(d.value.customer_name),1)):g("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1"},"PO Number",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.po_number=l),class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.po_number]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1"},"Address",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.customer_address=l),class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.customer_address]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-1"},"Payment Terms",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.payment_terms=l),placeholder:"eg: COD",class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.payment_terms]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block mb-1"},"Expedition",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.expedition=l),class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.expedition]])])]),t("div",null,[e[29]||(e[29]=t("h3",{class:"font-bold mb-2"},[_("Items "),t("span",{class:"text-red-600 font-bold"},"*"),_(" (At least 1 item required)")],-1)),d.value.items?(b(),c("div",ue," âš ï¸ "+m(d.value.items),1)):g("",!0),(b(!0),c(M,null,S(s.value.items,(l,a)=>(b(),c("div",{key:a,class:"grid grid-cols-7 gap-2 mb-2 items-end"},[t("div",re,[e[23]||(e[23]=t("label",{class:"block text-xs"},[_("Select Item "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),u(t("input",{"onUpdate:modelValue":n=>p[a]=n,type:"text",placeholder:"Search item...",onFocus:n=>p[a]=p[a]||"",class:h(["border px-2 py-1 rounded w-full text-sm",!l.item_id&&Object.keys(d.value).length>0?"border-red-600 bg-red-50":"border-gray-300"])},null,42,de),[[r,p[a]]]),p[a]&&j(a).length>0?(b(),c("div",ie,[(b(!0),c(M,null,S(j(a),n=>(b(),c("div",{key:n.id,onClick:N=>R(a,n),class:"px-2 py-2 hover:bg-blue-100 cursor-pointer text-sm border-b border-gray-200 last:border-b-0"},[t("div",me,m(n.name),1),t("div",be,m(n.code)+" â€¢ "+m(n.unit)+" â€¢ Rp "+m(C(n.price)),1)],8,pe))),128))])):g("",!0),p[a]&&j(a).length===0?(b(),c("div",ce," No items found ")):g("",!0),l.item_id?(b(),c("div",ve," âœ“ "+m(l.item_name),1)):g("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs"},"Code",-1)),u(t("input",{"onUpdate:modelValue":n=>l.item_code=n,class:"border border-gray-300 px-2 py-1 rounded w-full text-sm"},null,8,ye),[[r,l.item_code]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs"},"Name",-1)),u(t("input",{"onUpdate:modelValue":n=>l.item_name=n,class:"border border-gray-300 px-2 py-1 rounded w-full text-sm"},null,8,fe),[[r,l.item_name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-xs"},[_("Qty "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),u(t("input",{"onUpdate:modelValue":n=>l.quantity=n,type:"number",required:"",class:h(["border px-2 py-1 rounded w-full text-sm",!l.quantity&&Object.keys(d.value).length>0?"border-red-600 bg-red-50":"border-gray-300"])},null,10,xe),[[r,l.quantity,void 0,{number:!0}]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs"},[_("Price "),t("span",{class:"text-red-600 font-bold"},"*")],-1)),u(t("input",{"onUpdate:modelValue":n=>l.unit_price=n,type:"number",required:"",class:h(["border px-2 py-1 rounded w-full text-sm",!l.unit_price&&Object.keys(d.value).length>0?"border-red-600 bg-red-50":"border-gray-300"])},null,10,ge),[[r,l.unit_price,void 0,{number:!0}]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs"},"Disc",-1)),u(t("input",{"onUpdate:modelValue":n=>l.discount=n,type:"number",class:"border border-gray-300 px-2 py-1 rounded w-full text-sm"},null,8,_e),[[r,l.discount,void 0,{number:!0}]])]),t("div",we,[t("span",he,m(C((l.quantity||0)*(l.unit_price||0)-(l.discount||0))),1),t("button",{type:"button",onClick:n=>G(a),class:"text-red-600 hover:text-red-800"}," ðŸ—‘ ",8,ke)])]))),128)),t("button",{type:"button",onClick:Q,class:"text-blue-600 text-sm hover:text-blue-800"}," + Add Item ")]),t("div",Ve,[t("div",null,[e[30]||(e[30]=t("label",{class:"block mb-1"},"Discount",-1)),u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.discount=l),type:"number",class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.discount,void 0,{number:!0}]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block mb-1"},"PPN %",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.ppn_percent=l),type:"number",class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.ppn_percent,void 0,{number:!0}]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block mb-1"},"Other Charges",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.other_charges=l),type:"number",class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.other_charges,void 0,{number:!0}]])])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block mb-1"},"Terbilang (amount in words) - Auto-calculated from total",-1)),t("div",Ue,m(z.value),1)]),t("div",Ie,[t("div",null,[e[34]||(e[34]=t("label",{class:"block mb-1"},"Prepared By",-1)),u(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.prepared_by=l),class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.prepared_by]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block mb-1"},"Approved By",-1)),u(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.approved_by=l),class:"border px-3 py-2 rounded w-full"},null,512),[[r,s.value.approved_by]])])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block mb-1"},"Notes / Keterangan",-1)),u(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.notes=l),class:"border px-3 py-2 rounded w-full",rows:"4"},null,512),[[r,s.value.notes]])]),t("div",qe," Total: "+m(C(D.value)),1),t("div",Ce,[t("button",{type:"button",onClick:e[14]||(e[14]=l=>o.$router.push("/app/invoices/invoices")),class:"px-4 py-2 border rounded"}," Cancel "),e[37]||(e[37]=t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded"}," Save ",-1))])],32)]))}};export{Oe as default};
