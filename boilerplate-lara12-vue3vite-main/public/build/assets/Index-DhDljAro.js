import{_ as y,G as u,o as d,c,a as e,h as f,e as p,j as x,K as v,t as l,k as h,J as k,F as m,l as w,s as b}from"./app-Kf_TfGnx.js";const _={name:"QuotationIndex",data(){return{quotations:[],loading:!1,loadingPdfId:null,search:"",status:"DRAFT",selectedQuotations:[],selectAll:!1,pagination:{current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}}},computed:{hasOnlyDrafts(){return this.selectedQuotations.length===0?!1:this.quotations.filter(s=>this.selectedQuotations.includes(s.id)).every(s=>s.status==="DRAFT")},hasOnlyQuoted(){return this.selectedQuotations.length===0?!1:this.quotations.filter(s=>this.selectedQuotations.includes(s.id)).every(s=>s.status==="QUOTED")}},mounted(){this.load()},methods:{async load(){this.loading=!0,this.selectedQuotations=[],this.selectAll=!1;try{const s={page:this.pagination.current_page,per_page:this.pagination.per_page,search:this.search,status:this.status||"DRAFT,QUOTED"},{data:t}=await u.get("/invoices",{params:s});this.quotations=t.data,this.pagination={current_page:t.current_page,last_page:t.last_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to}}catch(s){console.error("Failed to load quotations:",s),this.$emit("showToast","Failed to load quotations","error")}finally{this.loading=!1}},isSelected(s){return this.selectedQuotations.includes(s)},toggleSelectAll(){this.selectAll?this.selectedQuotations=this.quotations.map(s=>s.id):this.selectedQuotations=[]},clearSelection(){this.selectedQuotations=[],this.selectAll=!1},changePage(s){s>=1&&s<=this.pagination.last_page&&(this.pagination.current_page=s,this.load())},formatCurrency(s){return"Rp "+Number(s).toLocaleString("id-ID")},getBadgeClass(s){return{DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",QUOTED:"bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100"}[s]||"bg-gray-100 text-gray-800"},async bulkMarkAsQuoted(){if(!confirm(`Mark ${this.selectedQuotations.length} quotation(s) as quoted?`))return;let s=0,t=0;for(const i of this.selectedQuotations)try{await u.post(`/invoices/${i}/mark-as-quoted`),s++}catch(n){console.error(`Failed to mark quotation ${i} as quoted:`,n),t++}s>0&&this.$emit("showToast",`âœ… ${s} quotation(s) marked as quoted`,"success"),t>0&&this.$emit("showToast",`âŒ ${t} quotation(s) failed`,"error"),this.clearSelection(),this.load()},async bulkConvertToInvoice(){if(!confirm(`Convert ${this.selectedQuotations.length} quotation(s) to invoice(s)?`))return;let s=0,t=0;for(const i of this.selectedQuotations)try{await u.post(`/invoices/${i}/mark-as-invoiced`),s++}catch(n){console.error(`Failed to convert quotation ${i}:`,n),t++}s>0&&this.$emit("showToast",`âœ… ${s} quotation(s) converted to invoice(s)`,"success"),t>0&&this.$emit("showToast",`âŒ ${t} quotation(s) failed`,"error"),this.clearSelection(),this.load()},async bulkDelete(){if(!confirm(`Delete ${this.selectedQuotations.length} quotation(s)? This cannot be undone.`))return;let s=0,t=0;for(const i of this.selectedQuotations)try{await u.delete(`/invoices/${i}`),s++}catch(n){console.error(`Failed to delete quotation ${i}:`,n),t++}s>0&&this.$emit("showToast",`âœ… ${s} quotation(s) deleted`,"success"),t>0&&this.$emit("showToast",`âŒ ${t} quotation(s) failed to delete`,"error"),this.clearSelection(),this.load()},async markAsQuoted(s){var t,i;if(confirm("Mark this quotation as quoted?"))try{await u.post(`/invoices/${s}/mark-as-quoted`),this.$emit("showToast","âœ… Quotation marked as quoted","success"),this.load()}catch(n){const a=((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to mark as quoted";this.$emit("showToast",a,"error")}},async convertToInvoice(s){var t,i;if(confirm("Convert this quotation to invoice?"))try{await u.post(`/invoices/${s}/mark-as-invoiced`),this.$emit("showToast","âœ… Converted to invoice successfully","success"),this.load()}catch(n){const a=((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to convert to invoice";this.$emit("showToast",a,"error")}},async downloadPdf(s){this.loadingPdfId=s;try{const{data:t}=await u.get(`/invoices/${s}/pdf`,{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([t])),n=document.createElement("a");n.href=i,n.setAttribute("download",`quotation-${s}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch{this.$emit("showToast","Failed to download PDF","error")}finally{this.loadingPdfId=null}}}},C={class:"p-6"},Q={class:"flex justify-between items-center mb-6"},T={class:"flex gap-4 mb-4"},D={key:0,class:"mb-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded p-4"},A={class:"flex justify-between items-center"},I={class:"text-sm font-medium dark:text-blue-400"},S={class:"flex gap-2"},F=["disabled"],P=["disabled"],q={class:"bg-white dark:bg-gray-800 rounded shadow overflow-x-auto"},M={class:"w-full"},U={class:"bg-gray-100 dark:bg-gray-700"},O={class:"p-3 text-left"},j={key:0,class:"border-t dark:border-gray-700"},E={key:1,class:"border-t dark:border-gray-700"},R={class:"p-3"},V=["value"],B={class:"p-3 dark:text-gray-300"},N={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},L={class:"p-3 dark:text-gray-300"},z={class:"p-3 dark:text-gray-300"},G={class:"p-3 text-right dark:text-gray-300"},H={class:"p-3 text-center"},J={class:"p-3"},K={class:"flex gap-2 justify-center"},W=["onClick"],X=["onClick"],Y=["onClick"],Z=["onClick"],$=["onClick","disabled"],tt={key:1,class:"mt-4 flex justify-between items-center dark:text-gray-300"},et={class:"flex gap-2"},st=["disabled"],ot=["disabled"];function at(s,t,i,n,a,r){return d(),c("div",C,[e("div",Q,[t[15]||(t[15]=e("h1",{class:"text-2xl font-bold dark:text-white"},"Quotations",-1)),e("button",{onClick:t[0]||(t[0]=o=>s.$router.push("/app/invoices/invoices/create")),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center gap-2"},t[14]||(t[14]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),f(" New Quotation ")]))]),e("div",T,[p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>a.search=o),onInput:t[2]||(t[2]=(...o)=>r.load&&r.load(...o)),placeholder:"Search...",class:"border dark:border-gray-600 px-3 py-2 rounded flex-1 dark:bg-gray-700 dark:text-white"},null,544),[[x,a.search]]),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.status=o),onChange:t[4]||(t[4]=(...o)=>r.load&&r.load(...o)),class:"border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white"},t[16]||(t[16]=[e("option",{value:""},"All Status",-1),e("option",{value:"DRAFT"},"Draft",-1),e("option",{value:"QUOTED"},"Quoted",-1)]),544),[[v,a.status]])]),a.selectedQuotations.length>0?(d(),c("div",D,[e("div",A,[e("span",I,l(a.selectedQuotations.length)+" item(s) selected",1),e("div",S,[e("button",{onClick:t[5]||(t[5]=(...o)=>r.bulkMarkAsQuoted&&r.bulkMarkAsQuoted(...o)),disabled:!r.hasOnlyDrafts,class:"bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-3 py-2 rounded text-sm"}," âœ… Mark as Quoted ",8,F),e("button",{onClick:t[6]||(t[6]=(...o)=>r.bulkConvertToInvoice&&r.bulkConvertToInvoice(...o)),disabled:!r.hasOnlyQuoted,class:"bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-3 py-2 rounded text-sm"}," ðŸ’° Convert to Invoice ",8,P),e("button",{onClick:t[7]||(t[7]=(...o)=>r.bulkDelete&&r.bulkDelete(...o)),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm"}," ðŸ—‘ Delete "),e("button",{onClick:t[8]||(t[8]=(...o)=>r.clearSelection&&r.clearSelection(...o)),class:"bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded text-sm"}," Clear ")])])])):h("",!0),e("div",q,[e("table",M,[e("thead",U,[e("tr",null,[e("th",O,[p(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=o=>a.selectAll=o),onChange:t[10]||(t[10]=(...o)=>r.toggleSelectAll&&r.toggleSelectAll(...o)),class:"w-4 h-4 cursor-pointer"},null,544),[[k,a.selectAll]])]),t[17]||(t[17]=e("th",{class:"p-3 text-left dark:text-gray-200"},"Invoice/Quote#",-1)),t[18]||(t[18]=e("th",{class:"p-3 text-left dark:text-gray-200"},"Date",-1)),t[19]||(t[19]=e("th",{class:"p-3 text-left dark:text-gray-200"},"Customer",-1)),t[20]||(t[20]=e("th",{class:"p-3 text-right dark:text-gray-200"},"Total",-1)),t[21]||(t[21]=e("th",{class:"p-3 text-center dark:text-gray-200"},"Status",-1)),t[22]||(t[22]=e("th",{class:"p-3 text-center dark:text-gray-200"},"Actions",-1))])]),e("tbody",null,[a.loading?(d(),c("tr",j,t[23]||(t[23]=[e("td",{colspan:"7",class:"p-4 text-center dark:text-gray-300"},"Loading...",-1)]))):a.quotations.length?(d(!0),c(m,{key:2},w(a.quotations,o=>(d(),c("tr",{key:o.id,class:b(`border-t dark:border-gray-700 ${r.isSelected(o.id)?"bg-blue-50 dark:bg-blue-900/30":"hover:bg-gray-50 dark:hover:bg-gray-700"}`)},[e("td",R,[p(e("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":t[11]||(t[11]=g=>a.selectedQuotations=g),class:"w-4 h-4 cursor-pointer"},null,8,V),[[k,a.selectedQuotations]])]),e("td",B,[e("div",null,l(o.quotation_number||o.invoice_number),1),o.project_name?(d(),c("div",N,l(o.project_name),1)):h("",!0)]),e("td",L,l(new Date(o.invoice_date).toLocaleDateString("id-ID")),1),e("td",z,l(o.customer_name),1),e("td",G,l(r.formatCurrency(o.total)),1),e("td",H,[e("span",{class:b([r.getBadgeClass(o.status),"px-2 py-1 rounded text-xs"])},l(o.status),3)]),e("td",J,[e("div",K,[e("button",{onClick:g=>s.$router.push(`/app/invoices/invoices/${o.id}`),class:"text-blue-600 dark:text-blue-400",title:"View"}," ðŸ‘ ",8,W),e("button",{onClick:g=>s.$router.push(`/app/invoices/invoices/${o.id}/edit`),class:"text-green-600 dark:text-green-400",title:"Edit"}," âœï¸ ",8,X),o.status==="DRAFT"?(d(),c("button",{key:0,onClick:g=>r.markAsQuoted(o.id),class:"text-purple-600 dark:text-purple-400",title:"Mark as Quoted"}," âœ… ",8,Y)):h("",!0),o.status==="QUOTED"?(d(),c("button",{key:1,onClick:g=>r.convertToInvoice(o.id),class:"text-indigo-600 dark:text-indigo-400",title:"Convert to Invoice"}," ðŸ’° ",8,Z)):h("",!0),e("button",{onClick:g=>r.downloadPdf(o.id),disabled:a.loadingPdfId===o.id,class:b(a.loadingPdfId===o.id?"text-gray-400 opacity-50 cursor-wait":"text-red-600 dark:text-red-400"),title:"Export PDF"},l(a.loadingPdfId===o.id?"â³":"ðŸ“„"),11,$)])])],2))),128)):(d(),c("tr",E,t[24]||(t[24]=[e("td",{colspan:"7",class:"p-4 text-center text-gray-500 dark:text-gray-400"},"No quotations found",-1)])))])])]),a.pagination.total>0?(d(),c("div",tt,[e("div",null," Showing "+l(a.pagination.from)+" to "+l(a.pagination.to)+" of "+l(a.pagination.total)+" entries ",1),e("div",et,[e("button",{onClick:t[12]||(t[12]=o=>r.changePage(a.pagination.current_page-1)),disabled:a.pagination.current_page===1,class:"px-3 py-1 border dark:border-gray-600 rounded disabled:opacity-50 dark:bg-gray-700"}," Previous ",8,st),e("button",{onClick:t[13]||(t[13]=o=>r.changePage(a.pagination.current_page+1)),disabled:a.pagination.current_page===a.pagination.last_page,class:"px-3 py-1 border dark:border-gray-600 rounded disabled:opacity-50 dark:bg-gray-700"}," Next ",8,ot)])])):h("",!0)])}const it=y(_,[["render",at]]);export{it as default};
