import{r as y,o as i,a as n,b as t,t as d,k as h,n as I,G as x,_ as M,g as D,f as k,j as C,v as V,K as F,F as _,m as w,e as N}from"./app-aQX-rcOb.js";const j={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},B={class:"bg-white rounded-lg shadow-xl w-full max-w-md p-6"},P={class:"mb-4"},T={key:0},z={key:1},A={class:"font-medium text-gray-800"},E={class:"text-xs text-gray-500 mt-1"},U={key:0,class:"mb-4"},$={class:"flex justify-end gap-3 mt-4"},K=["disabled"],L=["disabled"],O={__name:"ImportModal",props:{show:Boolean},emits:["close","success"],setup(s,{emit:e}){const c=e,u=y(null),o=y(!1),l=y(""),p=y(!1),r=m=>{const a=m.target.files[0];a&&(a.type==="text/csv"||a.type==="application/vnd.ms-excel"||a.name.endsWith(".csv")||a.name.endsWith(".txt")?(u.value=a,l.value="",p.value=!1):(l.value="Invalid file type. Please upload a CSV.",p.value=!0))},v=async()=>{var a,f;if(!u.value)return;o.value=!0,l.value="",p.value=!1;const m=new FormData;m.append("file",u.value);try{const b=await x.post("/items/import",m,{headers:{"Content-Type":"multipart/form-data"}});l.value=b.message||`Berhasil import ${b.count||0} item!`,p.value=!1,setTimeout(()=>{g(),c("success")},1500)}catch(b){console.error("Import error:",b);const S=((f=(a=b.response)==null?void 0:a.data)==null?void 0:f.message)||b.message||"Import gagal. Silakan cek format file CSV.";l.value=S,p.value=!0}finally{o.value=!1}},g=()=>{c("close"),u.value=null,l.value="",p.value=!1};return(m,a)=>s.show?(i(),n("div",j,[t("div",B,[a[5]||(a[5]=t("h2",{class:"text-xl font-bold mb-4"},"Import Items from CSV",-1)),t("div",P,[a[3]||(a[3]=t("p",{class:"text-sm text-gray-600 mb-2"}," Upload a CSV file with columns: Area, Item Name, Dimension, Price, Qty. ",-1)),t("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-colors cursor-pointer",onClick:a[0]||(a[0]=f=>m.$refs.fileInput.click())},[t("input",{ref:"fileInput",type:"file",class:"hidden",accept:".csv,.txt",onChange:r},null,544),u.value?(i(),n("div",z,[a[2]||(a[2]=t("span",{class:"text-green-500 text-4xl block mb-2"},"ðŸ“„",-1)),t("span",A,d(u.value.name),1),t("p",E,d((u.value.size/1024).toFixed(1))+" KB",1)])):(i(),n("div",T,a[1]||(a[1]=[t("span",{class:"text-gray-400 text-4xl block mb-2"},"ðŸ“‚",-1),t("span",{class:"text-blue-600 font-medium"},"Click to upload CSV",-1)])))])]),o.value?(i(),n("div",U,a[4]||(a[4]=[t("div",{class:"h-2 bg-gray-200 rounded-full overflow-hidden"},[t("div",{class:"h-full bg-blue-600 animate-pulse w-full"})],-1),t("p",{class:"text-xs text-center text-gray-500 mt-1"},"Processing...",-1)]))):h("",!0),l.value?(i(),n("div",{key:1,class:I(`mb-4 text-sm p-2 rounded ${p.value?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`)},d(l.value),3)):h("",!0),t("div",$,[t("button",{onClick:g,class:"px-4 py-2 border rounded hover:bg-gray-100 disabled:opacity-50",disabled:o.value}," Cancel ",8,K),t("button",{onClick:v,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:!u.value||o.value}," Import ",8,L)])])])):h("",!0)}},W={name:"ItemIndex",components:{ImportModal:O},data(){return{items:[],categories:[],loading:!1,showImportModal:!1,filters:{search:"",category_id:""},pagination:{current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}}},mounted(){this.loadCategories(),this.load()},computed:{groupedItems(){const s={};return this.items.forEach(e=>{const c=e.category?e.category.name:"Uncategorized";s[c]||(s[c]=[]),s[c].push(e)}),Object.keys(s).sort().reduce((e,c)=>(e[c]=s[c],e),{})}},methods:{async loadCategories(){try{const s=await x.get("/items/categories");this.categories=(s==null?void 0:s.data)||[]}catch(s){console.error("Failed to load categories:",s),this.categories=[]}},async load(){this.loading=!0;try{const s={page:this.pagination.current_page,per_page:60,...this.filters},e=await x.get("/items",{params:s});this.items=(e==null?void 0:e.data)||[],this.pagination={current_page:(e==null?void 0:e.current_page)||1,last_page:(e==null?void 0:e.last_page)||1,per_page:(e==null?void 0:e.per_page)||15,total:(e==null?void 0:e.total)||0,from:(e==null?void 0:e.from)||0,to:(e==null?void 0:e.to)||0}}catch(s){console.error("Failed to load items:",s),this.items=[],this.$emit("showToast","Failed to load items","error")}finally{this.loading=!1}},changePage(s){s>=1&&s<=this.pagination.last_page&&(this.pagination.current_page=s,this.load())},onImportSuccess(){this.showImportModal=!1,this.$emit("showToast","Items imported successfully!","success"),this.load(),this.loadCategories()},formatCurrency(s){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s)},async confirmDelete(s){var e,c;if(confirm(`Are you sure you want to delete item "${s.name}"?`))try{await x.delete(`/items/${s.id}`),this.$emit("showToast","Item deactivated successfully","success"),this.load()}catch(u){const o=((c=(e=u.response)==null?void 0:e.data)==null?void 0:c.message)||"Failed to delete item";this.$emit("showToast",o,"error")}}}},G={class:"p-6"},H={class:"flex justify-between mb-6"},Q={class:"flex gap-2"},R={class:"flex gap-4 mb-4 sticky top-0 bg-gray-50 dark:bg-gray-900 z-20 py-2"},q=["value"],J={key:0,class:"text-center py-8"},X={key:1,class:"text-center py-12 bg-white dark:bg-gray-800 rounded shadow"},Y={key:2},Z={class:"font-bold text-lg text-gray-700 dark:text-gray-200 border-b pb-2 mb-4 sticky top-14 bg-gray-50 dark:bg-gray-900 z-10 flex items-center gap-2"},ee={class:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full"},te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},se={class:"absolute top-3 right-3"},oe={class:"font-bold text-gray-800 dark:text-white pr-16 mb-1"},ae={class:"text-xs text-gray-500 dark:text-gray-400 mb-2 font-mono bg-gray-50 dark:bg-gray-700 inline-block px-1 rounded"},re={class:"flex justify-between items-end mt-4"},le={class:"font-bold text-blue-600 dark:text-blue-400"},ie={class:"text-[10px] text-gray-400"},ne={class:"flex gap-2 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity"},de=["onClick"],ce=["onClick"],ge={key:3,class:"mt-8 flex justify-between items-center bg-white dark:bg-gray-800 p-4 rounded shadow"},ue={class:"text-sm text-gray-600 dark:text-gray-300"},pe={class:"flex gap-2"},me=["disabled"],be={class:"px-3 py-1 bg-blue-50 text-blue-600 rounded font-bold"},ve=["disabled"];function ye(s,e,c,u,o,l){const p=D("ImportModal");return i(),n("div",G,[t("div",H,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold dark:text-white"},"Items & Services (Katalog)",-1)),t("div",Q,[t("button",{onClick:e[0]||(e[0]=r=>o.showImportModal=!0),class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded flex items-center gap-2"},e[9]||(e[9]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),k(" Import CSV ")])),t("button",{onClick:e[1]||(e[1]=r=>s.$router.push("/app/invoices/items/create")),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center gap-2"},e[10]||(e[10]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),k(" New Item ")]))])]),t("div",R,[C(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.filters.search=r),onInput:e[3]||(e[3]=(...r)=>l.load&&l.load(...r)),placeholder:"Search by name or code...",class:"border dark:border-gray-600 px-3 py-2 rounded flex-1 dark:bg-gray-700 dark:text-white shadow-sm"},null,544),[[V,o.filters.search]]),C(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.filters.category_id=r),onChange:e[5]||(e[5]=(...r)=>l.load&&l.load(...r)),class:"border dark:border-gray-600 px-3 py-2 rounded dark:bg-gray-700 dark:text-white shadow-sm"},[e[12]||(e[12]=t("option",{value:""},"All Categories",-1)),(i(!0),n(_,null,w(o.categories,r=>(i(),n("option",{key:r.id,value:r.id},d(r.name),9,q))),128))],544),[[F,o.filters.category_id]])]),o.loading?(i(),n("div",J,e[13]||(e[13]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-gray-500"},"Loading items...",-1)]))):o.items.length?(i(),n("div",Y,[(i(!0),n(_,null,w(l.groupedItems,(r,v)=>(i(),n("div",{key:v,class:"mb-8"},[t("h3",Z,[t("span",ee,d(r.length),1),k(" "+d(v||"Uncategorized"),1)]),t("div",te,[(i(!0),n(_,null,w(r,g=>(i(),n("div",{key:g.id,class:"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow relative group"},[t("div",se,[t("span",{class:I([g.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800","px-2 py-0.5 rounded text-[10px] uppercase font-bold tracking-wider"])},d(g.is_active?"Active":"Inactive"),3)]),t("div",oe,d(g.name),1),t("div",ae,d(g.code||"NO-CODE"),1),t("div",re,[t("div",null,[e[15]||(e[15]=t("div",{class:"text-xs text-gray-500"},"Price",-1)),t("div",le,d(l.formatCurrency(g.price)),1),t("div",ie,"per "+d(g.unit),1)]),t("div",ne,[t("button",{onClick:m=>s.$router.push(`/app/invoices/items/${g.id}/edit`),class:"p-2 bg-blue-50 text-blue-600 rounded hover:bg-blue-100",title:"Edit"}," âœï¸ ",8,de),t("button",{onClick:m=>l.confirmDelete(g),class:"p-2 bg-red-50 text-red-600 rounded hover:bg-red-100",title:"Delete"}," ðŸ—‘ ",8,ce)])])]))),128))])]))),128))])):(i(),n("div",X,e[14]||(e[14]=[t("p",{class:"text-gray-500 dark:text-gray-400"},"No items found matching your criteria.",-1)]))),o.pagination.total>0&&!o.loading?(i(),n("div",ge,[t("div",ue," Showing "+d(o.pagination.from)+" to "+d(o.pagination.to)+" of "+d(o.pagination.total)+" entries ",1),t("div",pe,[t("button",{onClick:e[6]||(e[6]=r=>l.changePage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-3 py-1 border rounded disabled:opacity-50 hover:bg-gray-50 dark:hover:bg-gray-700"}," Previous ",8,me),t("div",be,d(o.pagination.current_page),1),t("button",{onClick:e[7]||(e[7]=r=>l.changePage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-3 py-1 border rounded disabled:opacity-50 hover:bg-gray-50 dark:hover:bg-gray-700"}," Next ",8,ve)])])):h("",!0),N(p,{show:o.showImportModal,onClose:e[8]||(e[8]=r=>o.showImportModal=!1),onSuccess:l.onImportSuccess},null,8,["show","onSuccess"])])}const xe=M(W,[["render",ye]]);export{xe as default};
