import{r as f,o as d,c,a as t,t as l,k as b,s as C,G as x,_ as S,g as k,h as D,e as M,K as F,F as T,l as V,b as w,w as h}from"./app-yrMyzsrH.js";const A={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},$={class:"bg-white rounded-lg shadow-xl w-full max-w-md p-6"},N={class:"mb-4"},P={key:0},B={key:1},E={class:"font-medium text-gray-800"},j={class:"text-xs text-gray-500 mt-1"},z={key:0,class:"mb-4"},O={class:"flex justify-end gap-3 mt-4"},U=["disabled"],q=["disabled"],K={__name:"ImportModal",props:{show:Boolean},emits:["close","success"],setup(s,{emit:e}){const u=e,i=f(null),o=f(!1),n=f(""),m=f(!1),y=g=>{const r=g.target.files[0];r&&(r.type==="text/csv"||r.type==="application/vnd.ms-excel"||r.name.endsWith(".csv")||r.name.endsWith(".txt")?(i.value=r,n.value="",m.value=!1):(n.value="Invalid file type. Please upload a CSV.",m.value=!0))},a=async()=>{var r,v;if(!i.value)return;o.value=!0,n.value="",m.value=!1;const g=new FormData;g.append("file",i.value);try{const p=await x.post("/items/import",g,{headers:{"Content-Type":"multipart/form-data"}});n.value=p.message||`Berhasil import ${p.count||0} item!`,m.value=!1,setTimeout(()=>{_(),u("success")},1500)}catch(p){console.error("Import error:",p);const I=((v=(r=p.response)==null?void 0:r.data)==null?void 0:v.message)||p.message||"Import gagal. Silakan cek format file CSV.";n.value=I,m.value=!0}finally{o.value=!1}},_=()=>{u("close"),i.value=null,n.value="",m.value=!1};return(g,r)=>s.show?(d(),c("div",A,[t("div",$,[r[5]||(r[5]=t("h2",{class:"text-xl font-bold mb-4"},"Import Items from CSV",-1)),t("div",N,[r[3]||(r[3]=t("p",{class:"text-sm text-gray-600 mb-2"}," Upload a CSV file with columns: Area, Item Name, Dimension, Price, Qty. ",-1)),t("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-colors cursor-pointer",onClick:r[0]||(r[0]=v=>g.$refs.fileInput.click())},[t("input",{ref:"fileInput",type:"file",class:"hidden",accept:".csv,.txt",onChange:y},null,544),i.value?(d(),c("div",B,[r[2]||(r[2]=t("span",{class:"text-green-500 text-4xl block mb-2"},"ðŸ“„",-1)),t("span",E,l(i.value.name),1),t("p",j,l((i.value.size/1024).toFixed(1))+" KB",1)])):(d(),c("div",P,r[1]||(r[1]=[t("span",{class:"text-gray-400 text-4xl block mb-2"},"ðŸ“‚",-1),t("span",{class:"text-blue-600 font-medium"},"Click to upload CSV",-1)])))])]),o.value?(d(),c("div",z,r[4]||(r[4]=[t("div",{class:"h-2 bg-gray-200 rounded-full overflow-hidden"},[t("div",{class:"h-full bg-blue-600 animate-pulse w-full"})],-1),t("p",{class:"text-xs text-center text-gray-500 mt-1"},"Processing...",-1)]))):b("",!0),n.value?(d(),c("div",{key:1,class:C(`mb-4 text-sm p-2 rounded ${m.value?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`)},l(n.value),3)):b("",!0),t("div",O,[t("button",{onClick:_,class:"px-4 py-2 border rounded hover:bg-gray-100 disabled:opacity-50",disabled:o.value}," Cancel ",8,U),t("button",{onClick:a,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:!i.value||o.value}," Import ",8,q)])])])):b("",!0)}},L={name:"ItemIndex",components:{ImportModal:K},data(){return{items:[],categories:[],loading:!1,showImportModal:!1,filters:{search:"",category_id:""},pagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},columns:[{name:"Name",prop:"name"},{name:"Category",prop:"category"},{name:"Price",prop:"price"},{name:"Stock",prop:"stock"},{name:"Status",prop:"status"},{name:"Action",prop:"actions"}]}},mounted(){this.loadCategories(),this.load()},methods:{async loadCategories(){try{const s=await x.get("/items/categories");this.categories=(s==null?void 0:s.data)||[]}catch(s){console.error("Failed to load categories:",s),this.categories=[]}},async load(){this.loading=!0;try{const s={page:this.pagination.current_page,per_page:this.pagination.per_page,...this.filters},e=await x.get("/items",{params:s}),u=(e==null?void 0:e.data)||[];this.items=u.map(i=>{var o;return{...i,category_name:((o=i.category)==null?void 0:o.name)||"",stock:i.quantity||0,actions:{canUpdate:!0,canDelete:!0}}}),this.pagination={current_page:(e==null?void 0:e.current_page)||1,last_page:(e==null?void 0:e.last_page)||1,per_page:(e==null?void 0:e.per_page)||10,total:(e==null?void 0:e.total)||0,from:(e==null?void 0:e.from)||0,to:(e==null?void 0:e.to)||0}}catch(s){console.error("Failed to load items:",s),this.items=[],this.$emit("showToast","Failed to load items","error")}finally{this.loading=!1}},changePage(s){this.pagination.current_page=s,this.load()},handleSearch(s){this.filters.search=s,this.pagination.current_page=1,this.load()},navigateToAdd(){this.$router.push("/app/invoices/items/create")},navigateToEdit(s){this.$router.push(`/app/invoices/items/${s.id}/edit`)},onImportSuccess(){this.showImportModal=!1,this.$emit("showToast","Items imported successfully!","success"),this.load(),this.loadCategories()},formatCurrency(s){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s)},async confirmDelete(s){var e,u;if(confirm(`Are you sure you want to delete item "${s.name}"?`))try{await x.delete(`/items/${s.id}`),this.$emit("showToast","Item deleted successfully","success"),this.load()}catch(i){const o=((u=(e=i.response)==null?void 0:e.data)==null?void 0:u.message)||"Failed to delete item";this.$emit("showToast",o,"error")}}}},W={class:"p-4 bg-white block sm:flex items-center justify-between border-b border-gray-200 lg:mt-1.5 dark:bg-gray-800 dark:border-gray-700 rounded-xl"},G={class:"w-full mb-1"},Q={class:"flex justify-between items-center mb-4"},R={class:"mb-4"},H=["value"],J={class:"font-medium text-gray-900 dark:text-white"},X={class:"text-xs text-gray-500 dark:text-gray-400 font-mono"},Y={key:0,class:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300"},Z={key:1,class:"text-gray-400 text-xs"},ee={class:"font-medium text-primary-600 dark:text-primary-400"},te={class:"text-xs text-gray-400"},ae={class:"font-medium"};function se(s,e,u,i,o,n){const m=k("table-molecule"),y=k("ImportModal");return d(),c("div",W,[t("div",G,[t("div",Q,[e[5]||(e[5]=t("h1",{class:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white"},"Items & Services",-1)),t("button",{onClick:e[0]||(e[0]=a=>o.showImportModal=!0),class:"text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2.5 flex items-center gap-2 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800"},e[4]||(e[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),D(" Import CSV ")]))]),t("div",R,[M(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.filters.category_id=a),onChange:e[2]||(e[2]=(...a)=>n.load&&n.load(...a)),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full sm:w-auto p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[6]||(e[6]=t("option",{value:""},"All Categories",-1)),(d(!0),c(T,null,V(o.categories,a=>(d(),c("option",{key:a.id,value:a.id},l(a.name),9,H))),128))],544),[[F,o.filters.category_id]])]),w(m,{columns:o.columns,data:o.items,loading:o.loading,"server-side":!0,"total-items":o.pagination.total,"per-page":o.pagination.per_page,"current-page":o.pagination.current_page,"show-add-button":!0,"with-checkbox":!1,onPageChange:n.changePage,onSearch:n.handleSearch,onOnAdd:n.navigateToAdd,onEditClicked:n.navigateToEdit,onDeleteClicked:n.confirmDelete},{"column-name":h(({row:a})=>[t("div",J,l(a.name),1),t("div",X,l(a.code||"NO-CODE"),1)]),"column-category":h(({row:a})=>[a.category_name?(d(),c("span",Y,l(a.category_name),1)):(d(),c("span",Z,"Uncategorized"))]),"column-price":h(({row:a})=>[t("div",ee,l(n.formatCurrency(a.price)),1),t("div",te,"per "+l(a.unit),1)]),"column-stock":h(({row:a})=>[t("span",ae,l(a.quantity||0),1)]),"column-status":h(({row:a})=>[t("span",{class:C([a.is_active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300","px-2.5 py-0.5 rounded text-xs font-medium"])},l(a.is_active?"Active":"Inactive"),3)]),_:1},8,["columns","data","loading","total-items","per-page","current-page","onPageChange","onSearch","onOnAdd","onEditClicked","onDeleteClicked"])]),w(y,{show:o.showImportModal,onClose:e[3]||(e[3]=a=>o.showImportModal=!1),onSuccess:n.onImportSuccess},null,8,["show","onSuccess"])])}const re=S(L,[["render",se]]);export{re as default};
