import{_ as u,G as d,g as m,o as p,c as h,a as i,e as f,K as y,b,w as l,h as v,t as c,s as _}from"./app-yrMyzsrH.js";const w={name:"InvoiceIndex",data(){return{invoices:[],loading:!1,loadingPdfId:null,filters:{search:"",status:""},pagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},columns:[{name:"Invoice #",prop:"invoice_number"},{name:"Date",prop:"date"},{name:"Customer",prop:"customer_name"},{name:"Total",prop:"total"},{name:"Status",prop:"status"},{name:"Action",prop:"actions"}]}},mounted(){this.load()},methods:{async load(){this.loading=!0;try{const t={page:this.pagination.current_page,per_page:this.pagination.per_page,...this.filters},e=await d.get("/invoices",{params:t}),s=(e==null?void 0:e.data)||[];this.invoices=s.map(a=>({...a,date:a.invoice_date,actions:{canUpdate:!0,canDelete:!0},additional_action:[{name:"Download PDF",action:o=>this.downloadPdf(o.id)}]})),this.pagination={current_page:(e==null?void 0:e.current_page)||1,last_page:(e==null?void 0:e.last_page)||1,per_page:(e==null?void 0:e.per_page)||10,total:(e==null?void 0:e.total)||0,from:(e==null?void 0:e.from)||0,to:(e==null?void 0:e.to)||0}}catch(t){console.error("Failed to load invoices:",t),this.$emit("showToast","Failed to load invoices","error")}finally{this.loading=!1}},changePage(t){this.pagination.current_page=t,this.load()},handleSearch(t){this.filters.search=t,this.pagination.current_page=1,this.load()},navigateToAdd(){this.$router.push("/app/invoices/invoices/create")},navigateToDetail(t){this.$router.push(`/app/invoices/invoices/${t.id}`)},navigateToEdit(t){this.$router.push(`/app/invoices/invoices/${t.id}/edit`)},formatDate(t){return t?new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-"},formatCurrency(t){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(t)},getBadgeClass(t){return{draft:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",overdue:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",cancelled:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}[t]||"bg-gray-100 text-gray-800"},async downloadPdf(t){try{this.loadingPdfId=t,this.$emit("showToast","Generating PDF...","info");const e=await d.get(`invoices/${t}/pdf`,{responseType:"blob",headers:{Accept:"application/pdf"}}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.target="_blank",a.download=`invoice-${t}.pdf`,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(s),this.$emit("showToast","PDF Downloaded","success")}catch(e){console.error("PDF download failed",e),this.$emit("showToast","Failed to generate PDF","error")}finally{this.loadingPdfId=null}},async confirmDelete(t){var e,s;if(confirm(`Are you sure you want to delete invoice "${t.invoice_number}"?`))try{await d.delete(`/invoices/${t.id}`),this.$emit("showToast","Invoice deleted successfully","success"),this.load()}catch(a){const o=((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete invoice";this.$emit("showToast",o,"error")}}}},x={class:"p-4 bg-white block sm:flex items-center justify-between border-b border-gray-200 lg:mt-1.5 dark:bg-gray-800 dark:border-gray-700 rounded-xl"},k={class:"w-full mb-1"},D={class:"mb-4"},C={class:"text-right font-medium"};function P(t,e,s,a,o,r){const g=m("table-molecule");return p(),h("div",x,[i("div",k,[e[3]||(e[3]=i("div",{class:"mb-4"},[i("h1",{class:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white"},"Invoices")],-1)),i("div",D,[f(i("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.filters.status=n),onChange:e[1]||(e[1]=(...n)=>r.load&&r.load(...n)),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},e[2]||(e[2]=[i("option",{value:""},"All Status",-1),i("option",{value:"draft"},"Draft",-1),i("option",{value:"pending"},"Pending",-1),i("option",{value:"paid"},"Paid",-1)]),544),[[y,o.filters.status]])]),b(g,{columns:o.columns,data:o.invoices,loading:o.loading,"server-side":!0,"total-items":o.pagination.total,"per-page":o.pagination.per_page,"current-page":o.pagination.current_page,"show-add-button":!0,"with-checkbox":!1,onPageChange:r.changePage,onSearch:r.handleSearch,onOnAdd:r.navigateToAdd,onDetailClicked:r.navigateToDetail,onEditClicked:r.navigateToEdit,onDeleteClicked:r.confirmDelete},{"column-date":l(({row:n})=>[v(c(r.formatDate(n.invoice_date)),1)]),"column-total":l(({row:n})=>[i("div",C,c(r.formatCurrency(n.total)),1)]),"column-status":l(({row:n})=>[i("span",{class:_([r.getBadgeClass(n.status),"px-2.5 py-0.5 rounded text-xs font-medium"])},c(n.status),3)]),_:1},8,["columns","data","loading","total-items","per-page","current-page","onPageChange","onSearch","onOnAdd","onDetailClicked","onEditClicked","onDeleteClicked"])])])}const I=u(w,[["render",P]]);export{I as default};
