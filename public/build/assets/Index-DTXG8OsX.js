import{_ as p,G as l,g as b,o as h,c as g,a as n,e as f,K as v,t as d,k as m,b as y,w as u,h as k,s as x}from"./app-yrMyzsrH.js";const w={name:"QuotationIndex",data(){return{quotations:[],loading:!1,loadingPdfId:null,filters:{search:"",status:"DRAFT"},pagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},selectedQuotations:[],columns:[{name:"Quotation #",prop:"quotation_number"},{name:"Date",prop:"date"},{name:"Customer",prop:"customer_name"},{name:"Total",prop:"total"},{name:"Status",prop:"status"},{name:"Action",prop:"actions"}]}},computed:{hasOnlyDrafts(){return this.selectedQuotations.length===0?!1:this.quotations.filter(t=>this.selectedQuotations.includes(t.id)).every(t=>t.status==="DRAFT")},hasOnlyQuoted(){return this.selectedQuotations.length===0?!1:this.quotations.filter(t=>this.selectedQuotations.includes(t.id)).every(t=>t.status==="QUOTED")}},mounted(){this.load()},methods:{async load(){var e;this.loading=!0,this.selectedQuotations=[],this.$refs.table;try{const t={page:this.pagination.current_page,per_page:this.pagination.per_page,search:this.filters.search,status:this.filters.status||"DRAFT,QUOTED"},s=await l.get("/invoices",{params:t}),r=((e=s==null?void 0:s.data)==null?void 0:e.data)||(s==null?void 0:s.data)||[],i=(s==null?void 0:s.data)||s;this.quotations=r.map(a=>{const c=[{name:"Download PDF",action:o=>this.downloadPdf(o.id)}];return a.status==="DRAFT"&&c.unshift({name:"Mark as Quoted",action:o=>this.markAsQuoted(o.id)}),a.status==="QUOTED"&&c.unshift({name:"Convert to Invoice",action:o=>this.convertToInvoice(o.id)}),{...a,date:a.invoice_date,actions:{canUpdate:!0,canDelete:!0},additional_action:c}}),this.pagination={current_page:i.current_page||1,last_page:i.last_page||1,per_page:i.per_page||10,total:i.total||0,from:i.from||0,to:i.to||0}}catch(t){console.error("Failed to load quotations:",t),this.$emit("showToast","Failed to load quotations","error")}finally{this.loading=!1}},changePage(e){this.pagination.current_page=e,this.load()},handleSearch(e){this.filters.search=e,this.pagination.current_page=1,this.load()},navigateToAdd(){this.$router.push("/app/invoices/invoices/create")},navigateToDetail(e){this.$router.push(`/app/invoices/invoices/${e.id}`)},navigateToEdit(e){this.$router.push(`/app/invoices/invoices/${e.id}/edit`)},formatDate(e){return e?new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-"},formatCurrency(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)},getBadgeClass(e){return{DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",QUOTED:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"}[e]||"bg-gray-100 text-gray-800"},handleSelectionChange(e){this.selectedQuotations=e.map(t=>t.id)},clearSelection(){this.selectedQuotations=[],this.load()},async bulkMarkAsQuoted(){if(!confirm(`Mark ${this.selectedQuotations.length} quotation(s) as quoted?`))return;let e=0;for(const t of this.selectedQuotations)try{await l.post(`/invoices/${t}/mark-as-quoted`),e++}catch(s){console.error(s)}e&&this.$emit("showToast",`${e} marked as quoted`,"success"),this.load()},async bulkConvertToInvoice(){if(!confirm(`Convert ${this.selectedQuotations.length} quotation(s) to invoice?`))return;let e=0;for(const t of this.selectedQuotations)try{await l.post(`/invoices/${t}/mark-as-invoiced`),e++}catch(s){console.error(s)}e&&this.$emit("showToast",`${e} converted to invoice`,"success"),this.load()},async bulkDelete(){if(!confirm(`Delete ${this.selectedQuotations.length} quotation(s)?`))return;let e=0;for(const t of this.selectedQuotations)try{await l.delete(`/invoices/${t}`),e++}catch(s){console.error(s)}e&&this.$emit("showToast",`${e} deleted`,"success"),this.load()},async markAsQuoted(e){if(confirm("Mark as quoted?"))try{await l.post(`/invoices/${e}/mark-as-quoted`),this.$emit("showToast","Marked as quoted","success"),this.load()}catch{this.$emit("showToast","Failed to mark as quoted","error")}},async convertToInvoice(e){if(confirm("Convert to invoice?"))try{await l.post(`/invoices/${e}/mark-as-invoiced`),this.$emit("showToast","Converted to invoice","success"),this.load()}catch{this.$emit("showToast","Failed to convert","error")}},async downloadPdf(e){try{this.loadingPdfId=e,this.$emit("showToast","Generating PDF...","info");const t=await l.get(`invoices/${e}/pdf`,{responseType:"blob"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.target="_blank",r.download=`quotation-${e}.pdf`,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(s)}catch{this.$emit("showToast","Failed PDF download","error")}finally{this.loadingPdfId=null}},async confirmDelete(e){if(confirm(`Delete quotation ${e.quotation_number||e.invoice_number}?`))try{await l.delete(`/invoices/${e.id}`),this.$emit("showToast","Deleted","success"),this.load()}catch{this.$emit("showToast","Failed to delete","error")}}}},_={class:"p-4 bg-white block sm:flex items-center justify-between border-b border-gray-200 lg:mt-1.5 dark:bg-gray-800 dark:border-gray-700 rounded-xl"},D={class:"w-full mb-1"},C={class:"sm:flex sm:gap-4 mb-4"},T={key:0,class:"mb-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-3 flex flex-wrap gap-2 items-center justify-between"},Q={class:"text-sm font-medium text-blue-800 dark:text-blue-300"},q={class:"flex gap-2 flex-wrap"},A=["disabled"],F=["disabled"],I={class:"font-medium text-gray-900 dark:text-white"},S={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},R={class:"text-right font-medium"};function O(e,t,s,r,i,a){const c=b("table-molecule");return h(),g("div",_,[n("div",D,[t[7]||(t[7]=n("div",{class:"mb-4"},[n("h1",{class:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white"},"Quotations")],-1)),n("div",C,[f(n("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.filters.status=o),onChange:t[1]||(t[1]=(...o)=>a.load&&a.load(...o)),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},t[6]||(t[6]=[n("option",{value:""},"All Status",-1),n("option",{value:"DRAFT"},"Draft",-1),n("option",{value:"QUOTED"},"Quoted",-1)]),544),[[v,i.filters.status]])]),i.selectedQuotations.length>0?(h(),g("div",T,[n("span",Q,d(i.selectedQuotations.length)+" selected",1),n("div",q,[n("button",{onClick:t[2]||(t[2]=(...o)=>a.bulkMarkAsQuoted&&a.bulkMarkAsQuoted(...o)),disabled:!a.hasOnlyDrafts,class:"text-xs bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-3 py-2 rounded-lg transition-colors"}," âœ… Mark Quoted ",8,A),n("button",{onClick:t[3]||(t[3]=(...o)=>a.bulkConvertToInvoice&&a.bulkConvertToInvoice(...o)),disabled:!a.hasOnlyQuoted,class:"text-xs bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-3 py-2 rounded-lg transition-colors"}," ðŸ’° To Invoice ",8,F),n("button",{onClick:t[4]||(t[4]=(...o)=>a.bulkDelete&&a.bulkDelete(...o)),class:"text-xs bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg transition-colors"}," ðŸ—‘ Delete "),n("button",{onClick:t[5]||(t[5]=(...o)=>a.clearSelection&&a.clearSelection(...o)),class:"text-xs bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition-colors"}," Clear ")])])):m("",!0),y(c,{ref:"table",columns:i.columns,data:i.quotations,loading:i.loading,"server-side":!0,"total-items":i.pagination.total,"per-page":i.pagination.per_page,"current-page":i.pagination.current_page,"show-add-button":!0,"with-checkbox":!0,onPageChange:a.changePage,onSearch:a.handleSearch,onOnAdd:a.navigateToAdd,onDetailClicked:a.navigateToDetail,onEditClicked:a.navigateToEdit,onDeleteClicked:a.confirmDelete,onSelectionChange:a.handleSelectionChange},{"column-quotation_number":u(({row:o})=>[n("div",I,d(o.quotation_number||o.invoice_number),1),o.project_name?(h(),g("div",S,d(o.project_name),1)):m("",!0)]),"column-date":u(({row:o})=>[k(d(a.formatDate(o.invoice_date)),1)]),"column-total":u(({row:o})=>[n("div",R,d(a.formatCurrency(o.total)),1)]),"column-status":u(({row:o})=>[n("span",{class:x([a.getBadgeClass(o.status),"px-2.5 py-0.5 rounded text-xs font-medium"])},d(o.status),3)]),_:1},8,["columns","data","loading","total-items","per-page","current-page","onPageChange","onSearch","onOnAdd","onDetailClicked","onEditClicked","onDeleteClicked","onSelectionChange"])])])}const E=p(w,[["render",O]]);export{E as default};
